<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149147406-2"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-149147406-2');</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script><script src="tooltips.js"></script><script src="reach-pre.js"></script><link rel="stylesheet" href="tooltips.css"><link rel="stylesheet" href="reach.css"><link rel="stylesheet" href="minted.css"><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><link rel="manifest" href="/favicon/site.webmanifest"><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>4.3&nbsp;Workshop: Trust Fund</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Reach:<span class="mywbr"> &nbsp;</span> The Safest and Easiest DApp Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tut.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="guide.html" class="tocviewlink" data-pltdoc="x">Guide</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="workshop.html" class="tocviewselflink" data-pltdoc="x">Workshop</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ref.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>4&nbsp;</td><td><a href="workshop.html" class="tocviewlink" data-pltdoc="x">Workshop</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">4.1&nbsp;</td><td><a href="workshop-hash-lock.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Hash Lock</a></td></tr><tr><td align="right">4.2&nbsp;</td><td><a href="workshop-relay.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Relay Account</a></td></tr><tr><td align="right">4.3&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Trust Fund</a></td></tr><tr><td align="right">4.4&nbsp;</td><td><a href="workshop-fomo.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Fear of Missing Out</a></td></tr><tr><td align="right">4.5&nbsp;</td><td><a href="workshop-fomo-generalized.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Fear of Missing Out Generalized</a></td></tr><tr><td align="right">4.6&nbsp;</td><td><a href="workshop-rps-fair.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Fair Rock-<wbr></wbr>Paper-<wbr></wbr>Scissors</a></td></tr><tr><td align="right">4.7&nbsp;</td><td><a href="workshop-rps-eff.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Efficient Rock-<wbr></wbr>Paper-<wbr></wbr>Scissors</a></td></tr><tr><td align="right">4.8&nbsp;</td><td><a href="workshop-rental.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Rental Agreement</a></td></tr><tr><td align="right">4.9&nbsp;</td><td><a href="workshop-abstract-simul.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Simultaneous Games</a></td></tr><tr><td align="right">4.10&nbsp;</td><td><a href="workshop-guardian-account.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Guardian Account</a></td></tr><tr><td align="right">4.11&nbsp;</td><td><a href="workshop-utility.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Periodic Payment</a></td></tr><tr><td align="right">4.12&nbsp;</td><td><a href="workshop-nim.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Nim</a></td></tr><tr><td align="right">4.13&nbsp;</td><td><a href="workshop-ttt.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Tic-<wbr></wbr>Tac-<wbr></wbr>Toe</a></td></tr><tr><td align="right">4.14&nbsp;</td><td><a href="workshop-secured-loan.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Secured Loan</a></td></tr><tr><td align="right">4.15&nbsp;</td><td><a href="workshop-race.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Race</a></td></tr><tr><td align="right">4.16&nbsp;</td><td><a href="workshop-chicken-race.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Chicken</a></td></tr><tr><td align="right">4.17&nbsp;</td><td><a href="workshop-popularity-contest.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Popularity Contest</a></td></tr><tr><td align="right">4.18&nbsp;</td><td><a href="workshop-nft-dumb.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Simple NFT</a></td></tr><tr><td align="right">4.19&nbsp;</td><td><a href="workshop-raffle.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Raffle</a></td></tr><tr><td align="right">4.20&nbsp;</td><td><a href="workshop-rent-seeking.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Rent Seeking</a></td></tr><tr><td align="right">4.21&nbsp;</td><td><a href="workshop-remote.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Remote Objects</a></td></tr><tr><td align="right">4.22&nbsp;</td><td><a href="workshop-oracle.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Oracle</a></td></tr><tr><td align="right">4.23&nbsp;</td><td><a href="workshop-auction-te.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Timed English Auction</a></td></tr><tr><td align="right">4.24&nbsp;</td><td><a href="workshop-crowdfund.html" class="tocviewlink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Crowd-<wbr></wbr>funding</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td>4.3&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Workshop:<span class="mywbr"> &nbsp;</span> Trust Fund</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">4.3.1&nbsp;</td><td><a href="#%28part._workshop-trust-fund-pr%29" class="tocviewlink" data-pltdoc="x">Problem Analysis</a></td></tr><tr><td align="right">4.3.2&nbsp;</td><td><a href="#%28part._workshop-trust-fund-dd%29" class="tocviewlink" data-pltdoc="x">Data Definition</a></td></tr><tr><td align="right">4.3.3&nbsp;</td><td><a href="#%28part._workshop-trust-fund-cc%29" class="tocviewlink" data-pltdoc="x">Communication Construction</a></td></tr><tr><td align="right">4.3.4&nbsp;</td><td><a href="#%28part._workshop-trust-fund-ai%29" class="tocviewlink" data-pltdoc="x">Assertion Insertion</a></td></tr><tr><td align="right">4.3.5&nbsp;</td><td><a href="#%28part._workshop-trust-fund-ii%29" class="tocviewlink" data-pltdoc="x">Interaction Introduction</a></td></tr><tr><td align="right">4.3.6&nbsp;</td><td><a href="#%28part._workshop-trust-fund-de%29" class="tocviewlink" data-pltdoc="x">Deployment Decisions</a></td></tr><tr><td align="right">4.3.7&nbsp;</td><td><a href="#%28part._workshop-trust-fund-dns%29" class="tocviewlink" data-pltdoc="x">Discussion and Next Steps</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">4.3.1<tt>&nbsp;</tt></span><a href="#%28part._workshop-trust-fund-pr%29" class="tocsubseclink" data-pltdoc="x">Problem Analysis</a></td></tr><tr><td><span class="tocsublinknumber">4.3.2<tt>&nbsp;</tt></span><a href="#%28part._workshop-trust-fund-dd%29" class="tocsubseclink" data-pltdoc="x">Data Definition</a></td></tr><tr><td><span class="tocsublinknumber">4.3.3<tt>&nbsp;</tt></span><a href="#%28part._workshop-trust-fund-cc%29" class="tocsubseclink" data-pltdoc="x">Communication Construction</a></td></tr><tr><td><span class="tocsublinknumber">4.3.4<tt>&nbsp;</tt></span><a href="#%28part._workshop-trust-fund-ai%29" class="tocsubseclink" data-pltdoc="x">Assertion Insertion</a></td></tr><tr><td><span class="tocsublinknumber">4.3.5<tt>&nbsp;</tt></span><a href="#%28part._workshop-trust-fund-ii%29" class="tocsubseclink" data-pltdoc="x">Interaction Introduction</a></td></tr><tr><td><span class="tocsublinknumber">4.3.6<tt>&nbsp;</tt></span><a href="#%28part._workshop-trust-fund-de%29" class="tocsubseclink" data-pltdoc="x">Deployment Decisions</a></td></tr><tr><td><span class="tocsublinknumber">4.3.7<tt>&nbsp;</tt></span><a href="#%28part._workshop-trust-fund-dns%29" class="tocsubseclink" data-pltdoc="x">Discussion and Next Steps</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">0.1.2</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search docs..." title="Enter a search string to search the Reach documentation" onkeypress="return reach_DoSearch(event, this);"></form>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="workshop-relay.html" title="backward to &quot;4.2 Workshop: Relay Account&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="workshop.html" title="up to &quot;4 Workshop&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="workshop-fomo.html" title="forward to &quot;4.4 Workshop: Fear of Missing Out&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>4.3<tt>&nbsp;</tt><a name="(part._workshop-trust-fund)"></a>Workshop: Trust Fund</h4><p>In this workshop, we&rsquo;ll look at yet another strategy for transferring funds, but in this version, we&rsquo;ll think about it as establishing a "trust fund": a funder will establish an account for the receiver, which they must wait a certain amount of time to access, and if they do not, then it reverts to the funder, and if the funder does not claim it, then it is dormant and any third party can remove the funds.
You could think of this as a variant of the <a href="workshop-relay.html" data-pltdoc="x">relay account</a>, with a mandatory waiting period and two fallbacks on <a href="guide-timeout.html" data-pltdoc="x">non-participation</a>.</p><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>This workshop assumes that you have recently completed <a href="workshop-relay.html" data-pltdoc="x">Workshop: Relay Account</a>.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">We assume that you&rsquo;ll go through this workshop in a directory named <span class="stt">~/reach/workshop-trust-fund</span>:
</div><div class="SIntrapara"><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">mkdir -p ~/reach/</span><span class="stt">workshop-trust-fund</span></div></p><p><div class="SIntrapara">And that you have a copy of Reach <a href="install.html" data-pltdoc="x">installed</a> in <span class="stt">~/reach</span> so you can write
</div><div class="SIntrapara"><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">../reach version</span></div></p><p>And it will run Reach.</p><p><div class="SIntrapara">You should start off by initializing your Reach program:
</div><div class="SIntrapara"><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">../reach init</span></div></p><h5>4.3.1<tt>&nbsp;</tt><a name="(part._workshop-trust-fund-pr)"></a>Problem Analysis</h5><p>For this workshop, we&rsquo;ll provide some constraints on your solution and problem analysis, since we&rsquo;d like you to explore writing a Reach program with a specific design.</p><p><div class="SIntrapara">The overall purpose of this application is so that:
</div><div class="SIntrapara"><ul><li><p>The Funder must decide an amount of funds to provide, as well as all of the other parameters of the application.</p></li><li><p>The Funder will know the identity of the Receiver at the beginning.</p></li><li><p>Whomever ever ultimately receives the funds transfers it to themselves.</p></li></ul></div></p><p><div class="SIntrapara">With this in mind, let&rsquo;s answer the questions:
</div><div class="SIntrapara"><ul><li><p>What are the participants of the application?</p></li><li><p>What information do they know at the start of the program?</p></li><li><p>What information are they going to discover and use in the program?</p></li><li><p>What funds change ownership during the application and how?</p></li></ul></div></p><blockquote class="SCentered"><p><br/><br/><br/><span style="font-weight: bold">Stop!</span><br/>Write down the problem analysis of this program as a comment.<br/><br/><br/><br/></p></blockquote><p>Let&rsquo;s see how your answers compare to our answers:</p><ul><li><p>This application involves three participants: the Funder, the Receiver, and a Bystander.</p></li><li><p>The Funder knows the identity of the Receiver, the amount, as well as the maturity of the fund, and the delays beforewhich it will be declared dormant or forsook.</p></li><li><p>The Receiver and the Bystander don&rsquo;t learn or provide anything, aside from the existence of the fund and its maturity.</p></li><li><p>The funds start with the Funder and then move to either the Receiver, the Funder, or the Bystander, depending on when they are claimed.</p></li></ul><h5>4.3.2<tt>&nbsp;</tt><a name="(part._workshop-trust-fund-dd)"></a>Data Definition</h5><p>The next step of designing our program is representing this information in our program and deciding the <a href="ref-programs-module.html#%28tech._participant._interact._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant interact interface</span></a> for each participant.
In this application, we&rsquo;ll be using a new concept of Reach: the <a href="ref-model.html#%28tech._time._delta%29" class="techoutside" data-pltdoc="x"><span class="techinside">time delta</span></a>.
The trust fund has a "maturity", as well as the lengths of time before which the fund is forsook or abandoned.
In the fiat world, these would likely be expressed as real time durations, like months and years.
However, on most <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus networks</span></a> there is an abstraction of time into something like a "block height", which represents the number of rounds of consensus which have reached their conclusion.
There is a loose relationship of these notions to real-time, but most networks do not guarantee any particular connection.
(Indeed, such a connection between the abstract world of consensus networks and the "real" world is typically provided by an <a href="workshop-oracle.html" data-pltdoc="x">oracle</a>.)
Reach abstracts the details of particular consensus networks away into the concept of a <a href="ref-model.html#%28tech._time._delta%29" class="techoutside" data-pltdoc="x"><span class="techinside">time delta</span></a>, which is represented by an integer in Reach programs, and used in positions that reference time.</p><p>With that knowledge in hand,</p><blockquote class="SCentered"><p><br/><br/><br/><span style="font-weight: bold">Stop!</span><br/>Write down the data definitions for this program as definitions.<br/><br/><br/><br/></p></blockquote><p>Let&rsquo;s compare notes again.
Here&rsquo;s what we wrote in our program:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/workshop-trust-fund/index.rsh#L1-L21"><span class="stt">workshop-trust-fund/index.rsh</span></a><button class="btn" data-clipboard-text="'reach 0.1';

const common = {
  funded: Fun([], Null),
  ready : Fun([], Null),
  recvd : Fun([UInt], Null) };

export const main =
  Reach.App(
    { deployMode: 'firstMsg' },
    [ Participant('Funder', {
      ...common,
      getParams: Fun([], Object({
        receiverAddr: Address,
        payment:      UInt,
        maturity:     UInt,
        refund:       UInt,
        dormant:      UInt })) }),
      Participant('Receiver', common),
      Participant('Bystander', common) ],
    (Funder, Receiver, Bystander) =&gt; {"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span> <span class="mi">1</span>    <span class="s1">&#39;reach 0.1&#39;</span><span class="p">;</span>
 <span class="mi">2</span>    
 <span class="mi">3</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">common</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">{</span>
 <span class="mi">4</span>      <font class="badlink"><span class="nx">funded</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">),</span>
 <span class="mi">5</span>      <font class="badlink"><span class="nx">ready</span></font> <font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">),</span>
 <span class="mi">6</span>      <font class="badlink"><span class="nx">recvd</span></font> <font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([</span><a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">)</span> <span class="p">};</span>
 <span class="mi">7</span>    
 <span class="mi">8</span>    <a href="ref-programs-module.html#%28reach._%28%28export%29%29%29" class="kd" data-pltdoc="x">export</a> <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">main</span></font> <font class="badlink"><span class="o">=</span></font>
 <span class="mi">9</span>      <a href="ref-programs-module.html#%28reach._%28%28.Reach%29%29%29" class="nb" data-pltdoc="x">Reach</a><span class="p">.</span><a href="ref-programs-module.html#%28reach._%28%28.App%29%29%29" class="nb" data-pltdoc="x">App</a><span class="p">(</span>
<span class="mi">10</span>        <span class="p">{</span> <a href="ref-programs-module.html#%28reach._%28%28deploy.Mode%29%29%29" class="nb" data-pltdoc="x">deployMode</a><font class="badlink"><span class="o">:</span></font> <span class="s1">&#39;firstMsg&#39;</span> <span class="p">},</span>
<span class="mi">11</span>        <span class="p">[</span> <a href="ref-programs-module.html#%28reach._%28%28.Participant%29%29%29" class="nb" data-pltdoc="x">Participant</a><span class="p">(</span><span class="s1">&#39;Funder&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="mi">12</span>    <span class="p">...</span><font class="badlink"><span class="nx">common</span></font><span class="p">,</span>
<span class="mi">13</span>    <font class="badlink"><span class="nx">getParams</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Object%29%29%29" class="nb" data-pltdoc="x">Object</a><span class="p">({</span>
<span class="mi">14</span>      <font class="badlink"><span class="nx">receiverAddr</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Address%29%29%29" class="nb" data-pltdoc="x">Address</a><span class="p">,</span>
<span class="mi">15</span>      <font class="badlink"><span class="nx">payment</span></font><font class="badlink"><span class="o">:</span></font>      <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">,</span>
<span class="mi">16</span>      <font class="badlink"><span class="nx">maturity</span></font><font class="badlink"><span class="o">:</span></font>     <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">,</span>
<span class="mi">17</span>      <font class="badlink"><span class="nx">refund</span></font><font class="badlink"><span class="o">:</span></font>       <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">,</span>
<span class="mi">18</span>      <font class="badlink"><span class="nx">dormant</span></font><font class="badlink"><span class="o">:</span></font>      <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a> <span class="p">}))</span> <span class="p">}),</span>
<span class="mi">19</span>    <a href="ref-programs-module.html#%28reach._%28%28.Participant%29%29%29" class="nb" data-pltdoc="x">Participant</a><span class="p">(</span><span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">common</span></font><span class="p">),</span>
<span class="mi">20</span>    <a href="ref-programs-module.html#%28reach._%28%28.Participant%29%29%29" class="nb" data-pltdoc="x">Participant</a><span class="p">(</span><span class="s1">&#39;Bystander&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">common</span></font><span class="p">)</span> <span class="p">],</span>
<span class="mi">21</span>        <span class="p">(</span><font class="badlink"><span class="nx">Funder</span></font><span class="p">,</span> <font class="badlink"><span class="nx">Receiver</span></font><span class="p">,</span> <font class="badlink"><span class="nx">Bystander</span></font><span class="p">)</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>We&rsquo;ve represented most values as <code class="highlight"><a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a></code> fields, and created a "common" interface that has a series of signals for the different phases of the application: one for when the account is <code class="highlight"><font class="badlink"><span class="nx">funded</span></font></code>, one for when the particular participant is <code class="highlight"><font class="badlink"><span class="nx">ready</span></font></code> to extract the funds, and finally one for when they have successfuly <code class="highlight"><font class="badlink"><span class="nx">recvd</span></font></code> (received) them.</p><h5>4.3.3<tt>&nbsp;</tt><a name="(part._workshop-trust-fund-cc)"></a>Communication Construction</h5><p>Now, we can write down the structure of communication and action in our application.
Try this on your own based on your experience with <a href="" data-pltdoc="x">Workshop: Trust Fund</a>.</p><blockquote class="SCentered"><p><br/><br/><br/><span style="font-weight: bold">Stop!</span><br/>Write down the communication pattern for this program as comments.<br/><br/><br/><br/></p></blockquote><p>Here&rsquo;s what we wrote:
<div class="highlight"><pre><span></span><span class="c1">// 1. The Funder publishes the parameters of the fund and makes the initial deposit.</span>
<span class="c1">// 2. The consensus remembers who the Receiver is.</span>
<span class="c1">// 3. Everyone waits for the fund to mature.</span>
<span class="c1">// 4. The Receiver may extract the funds with a deadline of `refund`.</span>
<span class="c1">// 5. The Funder may extract the funds with a deadline of `dormant`.</span>
<span class="c1">// 6. The Bystander may extract the funds with no deadline.</span>
</pre></div></p><p>The next step is to convert this pattern into actual program code using <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a></code>, <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a></code>, and <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a></code>.
However, this program gives us the opportunity to look at a few more features of Reach.</p><p>First, how do we implement step three, where each party waits for the fund to mature?
Reach has a primitive named <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28wait%29%29%29" class="nx" data-pltdoc="x">wait</a></code> which causes this to happen.
This may only occur in a <a href="ref-model.html#%28tech._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">step</span></a>, which is the same context where <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a></code> may occur.
This primitive, however, doesn&rsquo;t just cause the <span class="emph">participants</span> to wait, instead it guarantees that the entire computation waits.
In other words, this means that the <a href="ref-model.html#%28tech._contract%29" class="techoutside" data-pltdoc="x"><span class="techinside">contract</span></a> will ensure that the later steps do not occur until after the waiting time.</p><p>Second, how do we implement steps four and five, where there is a deadline for an action to take place?
Reach <a href="ref-model.html#%28tech._publication%29" class="techoutside" data-pltdoc="x"><span class="techinside">publication</span></a> steps take an option called <code class="highlight"><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a></code> that specifies an alternative computation to occur if the first does not take place before the deadline.
The syntax looks like: <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">().</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><font class="badlink"><span class="nx">deadline</span></font><span class="p">,</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <font class="badlink"><span class="nx">alternative</span></font><span class="p">)</span></code>, which uses the <a href="ref-programs-compute.html#%28tech._arrow._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">arrow expression</span></a> syntax for specifying the alternative computation.</p><p>Finally, we hope you notice that steps four, five, and six are extremely similar.
Consider trying to write a function that is used three times to implement all of them!</p><blockquote class="SCentered"><p><br/><br/><br/><span style="font-weight: bold">Stop!</span><br/>Write down the communication pattern for this program as code.<br/><br/><br/><br/></p></blockquote><p>The body of your application should look something like:
<div class="highlight"><pre><span></span><span class="c1">// 1. The Funder publishes the parameters of the fund and makes the initial deposit.</span>
<font class="badlink"><span class="nx">Funder</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">receiverAddr</span></font><span class="p">,</span> <font class="badlink"><span class="nx">payment</span></font><span class="p">,</span> <font class="badlink"><span class="nx">maturity</span></font><span class="p">,</span> <font class="badlink"><span class="nx">refund</span></font><span class="p">,</span> <font class="badlink"><span class="nx">dormant</span></font> <span class="p">)</span>
  <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a><span class="p">(</span><font class="badlink"><span class="nx">payment</span></font><span class="p">);</span>

<span class="c1">// 2. The consensus remembers who the Receiver is.</span>
<font class="badlink"><span class="nx">Receiver</span></font><span class="p">.</span><a href="ref-programs-compute.html#%28reach._%28%28set%29%29%29" class="nx" data-pltdoc="x">set</a><span class="p">(</span><font class="badlink"><span class="nx">receiverAddr</span></font><span class="p">);</span>
<a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>

<span class="c1">// 3. Everyone waits for the fund to mature.</span>
<a href="ref-programs-step.html#%28reach._%28%28wait%29%29%29" class="nx" data-pltdoc="x">wait</a><span class="p">(</span><font class="badlink"><span class="nx">maturity</span></font><span class="p">);</span>

<span class="c1">// 4. The Receiver may extract the funds with a deadline of `refund`.</span>
<font class="badlink"><span class="nx">Receiver</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">()</span>
  <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><font class="badlink"><span class="nx">refund</span></font><span class="p">,</span>
    <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
     <span class="c1">// 5. The Funder may extract the funds with a deadline of `dormant`.</span>
      <font class="badlink"><span class="nx">Funder</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">()</span>
        <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><font class="badlink"><span class="nx">dormant</span></font><span class="p">,</span>
          <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
            <span class="c1">// 6. The Bystander may extract the funds with no deadline.</span>
            <font class="badlink"><span class="nx">Bystander</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">();</span>
            <a href="ref-programs-consensus.html#%28reach._%28%28transfer%29%29%29" class="k" data-pltdoc="x">transfer</a><span class="p">(</span><font class="badlink"><span class="nx">payment</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">Bystander</span></font><span class="p">);</span>
            <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
            <a href="ref-programs-step.html#%28reach._%28%28exit%29%29%29" class="k" data-pltdoc="x">exit</a><span class="p">();</span> <span class="p">});</span>
       <a href="ref-programs-consensus.html#%28reach._%28%28transfer%29%29%29" class="k" data-pltdoc="x">transfer</a><span class="p">(</span><font class="badlink"><span class="nx">payment</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">Funder</span></font><span class="p">);</span>
       <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
       <a href="ref-programs-step.html#%28reach._%28%28exit%29%29%29" class="k" data-pltdoc="x">exit</a><span class="p">();</span> <span class="p">});</span>
<a href="ref-programs-consensus.html#%28reach._%28%28transfer%29%29%29" class="k" data-pltdoc="x">transfer</a><span class="p">(</span><font class="badlink"><span class="nx">payment</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">Receiver</span></font><span class="p">);</span>
<a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<a href="ref-programs-step.html#%28reach._%28%28exit%29%29%29" class="k" data-pltdoc="x">exit</a><span class="p">();</span>
</pre></div></p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>If you&rsquo;d like to see how you might contain the repetition into a function, keep reading!</p></blockquote></blockquote></blockquote><h5>4.3.4<tt>&nbsp;</tt><a name="(part._workshop-trust-fund-ai)"></a>Assertion Insertion</h5><p>As usual, we should consider what assertions we can add to our program, but this program doesn&rsquo;t have any interesting properties to prove, so we&rsquo;ll move on.
Or rather, all of its interesting properties are the ones automatically included in all Reach programs, like that the funds are used linearly and nothing is left over in the account at the end, or that the protocol steps must be received before the corresponding deadlines.</p><h5>4.3.5<tt>&nbsp;</tt><a name="(part._workshop-trust-fund-ii)"></a>Interaction Introduction</h5><p>Next, we need to insert the appropriate calls to <code class="highlight"><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a></code>.
In this case, our program is very simple and we expect you&rsquo;ll do a great job without further discussion.
However, if you want to simplify things, you might like to use <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28each%29%29%29" class="k" data-pltdoc="x">each</a></code> to signal to all the parties that the account is funded, rather than duplicating the interaction code over and over.</p><blockquote class="SCentered"><p><br/><br/><br/><span style="font-weight: bold">Stop!</span><br/>Insert <code class="highlight"><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a></code> calls to the <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> into the program.<br/><br/><br/><br/></p></blockquote><p>Let&rsquo;s look at our whole program now:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/workshop-trust-fund/index.rsh"><span class="stt">workshop-trust-fund/index.rsh</span></a><button class="btn" data-clipboard-text="'reach 0.1';

const common = {
  funded: Fun([], Null),
  ready : Fun([], Null),
  recvd : Fun([UInt], Null) };

export const main =
  Reach.App(
    { deployMode: 'firstMsg' },
    [ Participant('Funder', {
      ...common,
      getParams: Fun([], Object({
        receiverAddr: Address,
        payment:      UInt,
        maturity:     UInt,
        refund:       UInt,
        dormant:      UInt })) }),
      Participant('Receiver', common),
      Participant('Bystander', common) ],
    (Funder, Receiver, Bystander) =&gt; {
      Funder.only(() =&gt; {
        const { receiverAddr,
                payment, maturity, refund, dormant }
              = declassify(interact.getParams()); });
      Funder.publish(
        receiverAddr,
        payment, maturity, refund, dormant )
        .pay(payment);
      Receiver.set(receiverAddr);
      commit();

      each([Funder, Receiver, Bystander], () =&gt; {
        interact.funded(); });
      wait(maturity);

      const giveChance = (Who, then) =&gt; {
        Who.only(() =&gt; interact.ready());

        if ( then ) {
          Who.publish()
            .timeout(then.deadline, () =&gt; then.after()); }
        else {
          Who.publish(); }

        transfer(payment).to(Who);
        commit();
        Who.only(() =&gt; interact.recvd(payment));
        exit(); };

      giveChance(
        Receiver,
        { deadline: refund,
          after: () =&gt;
          giveChance(
            Funder,
            { deadline: dormant,
              after: () =&gt;
              giveChance(Bystander, false) }) }); });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span> <span class="mi">1</span>    <span class="s1">&#39;reach 0.1&#39;</span><span class="p">;</span>
 <span class="mi">2</span>    
 <span class="mi">3</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">common</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">{</span>
 <span class="mi">4</span>      <font class="badlink"><span class="nx">funded</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">),</span>
 <span class="mi">5</span>      <font class="badlink"><span class="nx">ready</span></font> <font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">),</span>
 <span class="mi">6</span>      <font class="badlink"><span class="nx">recvd</span></font> <font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([</span><a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">)</span> <span class="p">};</span>
 <span class="mi">7</span>    
 <span class="mi">8</span>    <a href="ref-programs-module.html#%28reach._%28%28export%29%29%29" class="kd" data-pltdoc="x">export</a> <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">main</span></font> <font class="badlink"><span class="o">=</span></font>
 <span class="mi">9</span>      <a href="ref-programs-module.html#%28reach._%28%28.Reach%29%29%29" class="nb" data-pltdoc="x">Reach</a><span class="p">.</span><a href="ref-programs-module.html#%28reach._%28%28.App%29%29%29" class="nb" data-pltdoc="x">App</a><span class="p">(</span>
<span class="mi">10</span>        <span class="p">{</span> <a href="ref-programs-module.html#%28reach._%28%28deploy.Mode%29%29%29" class="nb" data-pltdoc="x">deployMode</a><font class="badlink"><span class="o">:</span></font> <span class="s1">&#39;firstMsg&#39;</span> <span class="p">},</span>
<span class="mi">11</span>        <span class="p">[</span> <a href="ref-programs-module.html#%28reach._%28%28.Participant%29%29%29" class="nb" data-pltdoc="x">Participant</a><span class="p">(</span><span class="s1">&#39;Funder&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="mi">12</span>          <span class="p">...</span><font class="badlink"><span class="nx">common</span></font><span class="p">,</span>
<span class="mi">13</span>          <font class="badlink"><span class="nx">getParams</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Object%29%29%29" class="nb" data-pltdoc="x">Object</a><span class="p">({</span>
<span class="mi">14</span>            <font class="badlink"><span class="nx">receiverAddr</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Address%29%29%29" class="nb" data-pltdoc="x">Address</a><span class="p">,</span>
<span class="mi">15</span>            <font class="badlink"><span class="nx">payment</span></font><font class="badlink"><span class="o">:</span></font>      <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">,</span>
<span class="mi">16</span>            <font class="badlink"><span class="nx">maturity</span></font><font class="badlink"><span class="o">:</span></font>     <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">,</span>
<span class="mi">17</span>            <font class="badlink"><span class="nx">refund</span></font><font class="badlink"><span class="o">:</span></font>       <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">,</span>
<span class="mi">18</span>            <font class="badlink"><span class="nx">dormant</span></font><font class="badlink"><span class="o">:</span></font>      <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a> <span class="p">}))</span> <span class="p">}),</span>
<span class="mi">19</span>          <a href="ref-programs-module.html#%28reach._%28%28.Participant%29%29%29" class="nb" data-pltdoc="x">Participant</a><span class="p">(</span><span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">common</span></font><span class="p">),</span>
<span class="mi">20</span>          <a href="ref-programs-module.html#%28reach._%28%28.Participant%29%29%29" class="nb" data-pltdoc="x">Participant</a><span class="p">(</span><span class="s1">&#39;Bystander&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">common</span></font><span class="p">)</span> <span class="p">],</span>
<span class="mi">21</span>        <span class="p">(</span><font class="badlink"><span class="nx">Funder</span></font><span class="p">,</span> <font class="badlink"><span class="nx">Receiver</span></font><span class="p">,</span> <font class="badlink"><span class="nx">Bystander</span></font><span class="p">)</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">22</span>          <font class="badlink"><span class="nx">Funder</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">23</span>            <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <span class="p">{</span> <font class="badlink"><span class="nx">receiverAddr</span></font><span class="p">,</span>
<span class="mi">24</span>                    <font class="badlink"><span class="nx">payment</span></font><span class="p">,</span> <font class="badlink"><span class="nx">maturity</span></font><span class="p">,</span> <font class="badlink"><span class="nx">refund</span></font><span class="p">,</span> <font class="badlink"><span class="nx">dormant</span></font> <span class="p">}</span>
<span class="mi">25</span>                  <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">getParams</span></font><span class="p">());</span> <span class="p">});</span>
<span class="mi">26</span>          <font class="badlink"><span class="nx">Funder</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span>
<span class="mi">27</span>            <font class="badlink"><span class="nx">receiverAddr</span></font><span class="p">,</span>
<span class="mi">28</span>            <font class="badlink"><span class="nx">payment</span></font><span class="p">,</span> <font class="badlink"><span class="nx">maturity</span></font><span class="p">,</span> <font class="badlink"><span class="nx">refund</span></font><span class="p">,</span> <font class="badlink"><span class="nx">dormant</span></font> <span class="p">)</span>
<span class="mi">29</span>            <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a><span class="p">(</span><font class="badlink"><span class="nx">payment</span></font><span class="p">);</span>
<span class="mi">30</span>          <font class="badlink"><span class="nx">Receiver</span></font><span class="p">.</span><a href="ref-programs-compute.html#%28reach._%28%28set%29%29%29" class="nx" data-pltdoc="x">set</a><span class="p">(</span><font class="badlink"><span class="nx">receiverAddr</span></font><span class="p">);</span>
<span class="mi">31</span>          <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="mi">32</span>    
<span class="mi">33</span>          <a href="ref-programs-step.html#%28reach._%28%28each%29%29%29" class="k" data-pltdoc="x">each</a><span class="p">([</span><font class="badlink"><span class="nx">Funder</span></font><span class="p">,</span> <font class="badlink"><span class="nx">Receiver</span></font><span class="p">,</span> <font class="badlink"><span class="nx">Bystander</span></font><span class="p">],</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">34</span>            <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">funded</span></font><span class="p">();</span> <span class="p">});</span>
<span class="mi">35</span>          <a href="ref-programs-step.html#%28reach._%28%28wait%29%29%29" class="nx" data-pltdoc="x">wait</a><span class="p">(</span><font class="badlink"><span class="nx">maturity</span></font><span class="p">);</span>
<span class="mi">36</span>    
<span class="mi">37</span>          <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">giveChance</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">Who</span></font><span class="p">,</span> <font class="badlink"><span class="nx">then</span></font><span class="p">)</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">38</span>            <font class="badlink"><span class="nx">Who</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">ready</span></font><span class="p">());</span>
<span class="mi">39</span>    
<span class="mi">40</span>            <a href="ref-programs-compute.html#%28reach._%28%28if%29%29%29" class="k" data-pltdoc="x">if</a> <span class="p">(</span> <font class="badlink"><span class="nx">then</span></font> <span class="p">)</span> <span class="p">{</span>
<span class="mi">41</span>              <font class="badlink"><span class="nx">Who</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">()</span>
<span class="mi">42</span>                <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><font class="badlink"><span class="nx">then</span></font><span class="p">.</span><font class="badlink"><span class="nx">deadline</span></font><span class="p">,</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <font class="badlink"><span class="nx">then</span></font><span class="p">.</span><font class="badlink"><span class="nx">after</span></font><span class="p">());</span> <span class="p">}</span>
<span class="mi">43</span>            <a href="ref-programs-compute.html#%28reach._%28%28else%29%29%29" class="k" data-pltdoc="x">else</a> <span class="p">{</span>
<span class="mi">44</span>              <font class="badlink"><span class="nx">Who</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">();</span> <span class="p">}</span>
<span class="mi">45</span>    
<span class="mi">46</span>            <a href="ref-programs-consensus.html#%28reach._%28%28transfer%29%29%29" class="k" data-pltdoc="x">transfer</a><span class="p">(</span><font class="badlink"><span class="nx">payment</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">Who</span></font><span class="p">);</span>
<span class="mi">47</span>            <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="mi">48</span>            <font class="badlink"><span class="nx">Who</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">recvd</span></font><span class="p">(</span><font class="badlink"><span class="nx">payment</span></font><span class="p">));</span>
<span class="mi">49</span>            <a href="ref-programs-step.html#%28reach._%28%28exit%29%29%29" class="k" data-pltdoc="x">exit</a><span class="p">();</span> <span class="p">};</span>
<span class="mi">50</span>    
<span class="mi">51</span>          <font class="badlink"><span class="nx">giveChance</span></font><span class="p">(</span>
<span class="mi">52</span>            <font class="badlink"><span class="nx">Receiver</span></font><span class="p">,</span>
<span class="mi">53</span>            <span class="p">{</span> <font class="badlink"><span class="nx">deadline</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">refund</span></font><span class="p">,</span>
<span class="mi">54</span>              <font class="badlink"><span class="nx">after</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a>
<span class="mi">55</span>              <font class="badlink"><span class="nx">giveChance</span></font><span class="p">(</span>
<span class="mi">56</span>                <font class="badlink"><span class="nx">Funder</span></font><span class="p">,</span>
<span class="mi">57</span>                <span class="p">{</span> <font class="badlink"><span class="nx">deadline</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">dormant</span></font><span class="p">,</span>
<span class="mi">58</span>                  <font class="badlink"><span class="nx">after</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a>
<span class="mi">59</span>                  <font class="badlink"><span class="nx">giveChance</span></font><span class="p">(</span><font class="badlink"><span class="nx">Bystander</span></font><span class="p">,</span> <a href="ref-programs-compute.html#%28reach._%28%28false%29%29%29" class="kc" data-pltdoc="x">false</a><span class="p">)</span> <span class="p">})</span> <span class="p">});</span> <span class="p">});</span>
</pre></div></div></p><ul><li><p>Lines 33 and 34 use <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28each%29%29%29" class="k" data-pltdoc="x">each</a></code> to run the same code block <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a></code> in each of the given participants.</p></li><li><p>Lines 51 through 59 abstract the duplicate copied repeated structure of the program into three calls to the same function.</p></li><li><p>Lines 37 through 49 define this function as one that abstracts over who is permitted to extract the funds and whether there is a deadline.</p></li></ul><p>This program demonstrates some of the remarkable features of Reach: we were able to abstract away a pattern of communication into a function and use it repeatedly and in different ways.
Behind the scenes, when Reach compiles this program into a <a href="ref-model.html#%28tech._contract%29" class="techoutside" data-pltdoc="x"><span class="techinside">contract</span></a>, it will derive a four step protocol with implicit state to check that the appropriate participant takes their action only when allowed.</p><h5>4.3.6<tt>&nbsp;</tt><a name="(part._workshop-trust-fund-de)"></a>Deployment Decisions</h5><p>Next, it is time to test our program.
As usual, we&rsquo;ll present a completely automated test deployment, rather than an interactive one.
This means that we&rsquo;ll have to have our participants purposefully "miss" their deadlines so we can see that the timeouts and deadlines work correctly.
We&rsquo;ll implement it by abstracting away the test into a function of two parameters: booleans that decide whether the Receiver and Funder (respectively) should miss their deadline.
We&rsquo;ll implement this miss by using the standard library function <code class="highlight"><a href="ref-stdlib-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-stdlib-js.html#%28javascript._%28%28wait%29%29%29" class="nx" data-pltdoc="x">wait</a></code> which takes a <a href="ref-model.html#%28tech._time._delta%29" class="techoutside" data-pltdoc="x"><span class="techinside">time delta</span></a> encoded as a number.
This function is like <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28wait%29%29%29" class="nx" data-pltdoc="x">wait</a></code>, except it is local only to a single participant and has no bearing on the rules of the application.
It&rsquo;s just a convenience mechanism for allowing time to pass on the consensus network.</p><p>We highly recommend that you try to implement a test setup like this yourself; when you&rsquo;re done, scroll down to see our solution.</p><blockquote class="SCentered"><p><br/><br/><br/><span style="font-weight: bold">Stop!</span><br/>Decide how you will deploy and use this application.<br/><br/><br/><br/></p></blockquote><p>Here&rsquo;s the JavaScript <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> we wrote:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/workshop-trust-fund/index.mjs"><span class="stt">workshop-trust-fund/index.mjs</span></a><button class="btn" data-clipboard-text="import * as stdlib_loader from '@reach-sh/stdlib/loader.mjs';
import * as backend from './build/index.main.mjs';

const runDemo = async (delayReceiver, delayFunder) =&gt; {
  const stdlib = await stdlib_loader.loadStdlib();
  const getBalance = async (who) =&gt; stdlib.formatCurrency(
    await stdlib.balanceOf(who), 4,
  );

  const MATURITY = 10;
  const REFUND = 10;
  const DORMANT = 10;
  const fDelay = delayFunder ? MATURITY + REFUND + DORMANT + 1 : 0;
  const rDelay = delayReceiver ? MATURITY + REFUND + 1 : 0;
  console.log(`Begin demo with funder delay(${fDelay}) and receiver delay(${rDelay}).`);

  const common = (who, delay = 0) =&gt; ({
    funded: async () =&gt; {
      console.log(`${who} sees that the account is funded.`);
      if ( delay != 0 ) {
        console.log(`${who} begins to wait...`);
        await stdlib.wait(delay);
      }
    },
    ready : async () =&gt; console.log(`${who} is ready to receive the funds.`),
    recvd : async () =&gt; console.log(`${who} received the funds.`)
  });

  const startingBalance = stdlib.parseCurrency(100);

  const funder = await stdlib.newTestAccount(startingBalance);
  const receiver = await stdlib.newTestAccount(startingBalance);
  const bystander = await stdlib.newTestAccount(startingBalance);

  const ctcFunder = funder.deploy(backend);
  const ctcReceiver = receiver.attach(backend, ctcFunder.getInfo());
  const ctcBystander = bystander.attach(backend, ctcFunder.getInfo());

  await Promise.all([
    backend.Funder(ctcFunder, {
      ...common('Funder', fDelay),
      getParams: () =&gt; ({
        receiverAddr: receiver.networkAccount,
        payment: stdlib.parseCurrency(10),
        maturity: MATURITY,
        refund: REFUND,
        dormant: DORMANT,
      }),
    }),
    backend.Receiver(ctcReceiver, common('Receiver', rDelay)),
    backend.Bystander(ctcBystander, common('Bystander')),
  ]);
  for (const [who, acc] of [['Funder', funder], ['Receiver', receiver], ['Bystander', bystander]]) {
    console.log(`${who} has a balance of ${await getBalance(acc)}`);
  }
  console.log(`\n`);
};

(async () =&gt; {
  await runDemo(false, false);
  await runDemo(true, false);
  await runDemo(true, true);
})();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span>  <span class="mi">1</span>    <a href="ref-programs-module.html#%28reach._%28%28import%29%29%29" class="kd" data-pltdoc="x">import</a> <a href="ref-programs-compute.html#%28reach._%28%28%2A%29%29%29" class="o" data-pltdoc="x">*</a> <font class="badlink"><span class="kd">as</span></font> <font class="badlink"><span class="nx">stdlib_loader</span></font> <a href="ref-programs-module.html#%28reach._%28%28from%29%29%29" class="kd" data-pltdoc="x">from</a> <span class="s1">&#39;@reach-sh/stdlib/loader.mjs&#39;</span><span class="p">;</span>
  <span class="mi">2</span>    <a href="ref-programs-module.html#%28reach._%28%28import%29%29%29" class="kd" data-pltdoc="x">import</a> <a href="ref-programs-compute.html#%28reach._%28%28%2A%29%29%29" class="o" data-pltdoc="x">*</a> <font class="badlink"><span class="kd">as</span></font> <font class="badlink"><span class="nx">backend</span></font> <a href="ref-programs-module.html#%28reach._%28%28from%29%29%29" class="kd" data-pltdoc="x">from</a> <span class="s1">&#39;./build/index.main.mjs&#39;</span><span class="p">;</span>
  <span class="mi">3</span>    
  <span class="mi">4</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">runDemo</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">(</span><font class="badlink"><span class="nx">delayReceiver</span></font><span class="p">,</span> <font class="badlink"><span class="nx">delayFunder</span></font><span class="p">)</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
  <span class="mi">5</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">stdlib</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">stdlib_loader</span></font><span class="p">.</span><font class="badlink"><span class="nx">loadStdlib</span></font><span class="p">();</span>
  <span class="mi">6</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">getBalance</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">(</span><font class="badlink"><span class="nx">who</span></font><span class="p">)</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">formatCurrency</span></font><span class="p">(</span>
  <span class="mi">7</span>        <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">balanceOf</span></font><span class="p">(</span><font class="badlink"><span class="nx">who</span></font><span class="p">),</span> <span class="mi">4</span><span class="p">,</span>
  <span class="mi">8</span>      <span class="p">);</span>
  <span class="mi">9</span>    
 <span class="mi">10</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">MATURITY</span></font> <font class="badlink"><span class="o">=</span></font> <span class="mi">10</span><span class="p">;</span>
 <span class="mi">11</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">REFUND</span></font> <font class="badlink"><span class="o">=</span></font> <span class="mi">10</span><span class="p">;</span>
 <span class="mi">12</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">DORMANT</span></font> <font class="badlink"><span class="o">=</span></font> <span class="mi">10</span><span class="p">;</span>
 <span class="mi">13</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">fDelay</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">delayFunder</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~3f%29%29%29" class="o" data-pltdoc="x">?</a> <font class="badlink"><span class="nx">MATURITY</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <font class="badlink"><span class="nx">REFUND</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <font class="badlink"><span class="nx">DORMANT</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <span class="mi">1</span> <font class="badlink"><span class="o">:</span></font> <span class="mi">0</span><span class="p">;</span>
 <span class="mi">14</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">rDelay</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">delayReceiver</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~3f%29%29%29" class="o" data-pltdoc="x">?</a> <font class="badlink"><span class="nx">MATURITY</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <font class="badlink"><span class="nx">REFUND</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <span class="mi">1</span> <font class="badlink"><span class="o">:</span></font> <span class="mi">0</span><span class="p">;</span>
 <span class="mi">15</span>      <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Begin demo with funder delay(</span><span class="si">${</span><font class="badlink"><span class="nx">fDelay</span></font><span class="si">}</span><span class="sb">) and receiver delay(</span><span class="si">${</span><font class="badlink"><span class="nx">rDelay</span></font><span class="si">}</span><span class="sb">).`</span><span class="p">);</span>
 <span class="mi">16</span>    
 <span class="mi">17</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">common</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">who</span></font><span class="p">,</span> <font class="badlink"><span class="nx">delay</span></font> <font class="badlink"><span class="o">=</span></font> <span class="mi">0</span><span class="p">)</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">({</span>
 <span class="mi">18</span>        <font class="badlink"><span class="nx">funded</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
 <span class="mi">19</span>          <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">who</span></font><span class="si">}</span><span class="sb"> sees that the account is funded.`</span><span class="p">);</span>
 <span class="mi">20</span>          <a href="ref-programs-compute.html#%28reach._%28%28if%29%29%29" class="k" data-pltdoc="x">if</a> <span class="p">(</span> <font class="badlink"><span class="nx">delay</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%21~3d%29%29%29" class="o" data-pltdoc="x">!=</a> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
 <span class="mi">21</span>            <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">who</span></font><span class="si">}</span><span class="sb"> begins to wait...`</span><span class="p">);</span>
 <span class="mi">22</span>            <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28wait%29%29%29" class="nx" data-pltdoc="x">wait</a><span class="p">(</span><font class="badlink"><span class="nx">delay</span></font><span class="p">);</span>
 <span class="mi">23</span>          <span class="p">}</span>
 <span class="mi">24</span>        <span class="p">},</span>
 <span class="mi">25</span>        <font class="badlink"><span class="nx">ready</span></font> <font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">who</span></font><span class="si">}</span><span class="sb"> is ready to receive the funds.`</span><span class="p">),</span>
 <span class="mi">26</span>        <font class="badlink"><span class="nx">recvd</span></font> <font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">who</span></font><span class="si">}</span><span class="sb"> received the funds.`</span><span class="p">)</span>
 <span class="mi">27</span>      <span class="p">});</span>
 <span class="mi">28</span>    
 <span class="mi">29</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">startingBalance</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">parseCurrency</span></font><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
 <span class="mi">30</span>    
 <span class="mi">31</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">funder</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">newTestAccount</span></font><span class="p">(</span><font class="badlink"><span class="nx">startingBalance</span></font><span class="p">);</span>
 <span class="mi">32</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">receiver</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">newTestAccount</span></font><span class="p">(</span><font class="badlink"><span class="nx">startingBalance</span></font><span class="p">);</span>
 <span class="mi">33</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">bystander</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">newTestAccount</span></font><span class="p">(</span><font class="badlink"><span class="nx">startingBalance</span></font><span class="p">);</span>
 <span class="mi">34</span>    
 <span class="mi">35</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">ctcFunder</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">funder</span></font><span class="p">.</span><font class="badlink"><span class="nx">deploy</span></font><span class="p">(</span><font class="badlink"><span class="nx">backend</span></font><span class="p">);</span>
 <span class="mi">36</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">ctcReceiver</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">receiver</span></font><span class="p">.</span><font class="badlink"><span class="nx">attach</span></font><span class="p">(</span><font class="badlink"><span class="nx">backend</span></font><span class="p">,</span> <font class="badlink"><span class="nx">ctcFunder</span></font><span class="p">.</span><font class="badlink"><span class="nx">getInfo</span></font><span class="p">());</span>
 <span class="mi">37</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">ctcBystander</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">bystander</span></font><span class="p">.</span><font class="badlink"><span class="nx">attach</span></font><span class="p">(</span><font class="badlink"><span class="nx">backend</span></font><span class="p">,</span> <font class="badlink"><span class="nx">ctcFunder</span></font><span class="p">.</span><font class="badlink"><span class="nx">getInfo</span></font><span class="p">());</span>
 <span class="mi">38</span>    
 <span class="mi">39</span>      <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nb">Promise</span></font><span class="p">.</span><a href="ref-programs-compute.html#%28reach._%28%28all%29%29%29" class="nx" data-pltdoc="x">all</a><span class="p">([</span>
 <span class="mi">40</span>        <font class="badlink"><span class="nx">backend</span></font><span class="p">.</span><font class="badlink"><span class="nx">Funder</span></font><span class="p">(</span><font class="badlink"><span class="nx">ctcFunder</span></font><span class="p">,</span> <span class="p">{</span>
 <span class="mi">41</span>          <span class="p">...</span><font class="badlink"><span class="nx">common</span></font><span class="p">(</span><span class="s1">&#39;Funder&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">fDelay</span></font><span class="p">),</span>
 <span class="mi">42</span>          <font class="badlink"><span class="nx">getParams</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">({</span>
 <span class="mi">43</span>            <font class="badlink"><span class="nx">receiverAddr</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">receiver</span></font><span class="p">.</span><font class="badlink"><span class="nx">networkAccount</span></font><span class="p">,</span>
 <span class="mi">44</span>            <font class="badlink"><span class="nx">payment</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">stdlib</span></font><span class="p">.</span><font class="badlink"><span class="nx">parseCurrency</span></font><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
 <span class="mi">45</span>            <font class="badlink"><span class="nx">maturity</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">MATURITY</span></font><span class="p">,</span>
 <span class="mi">46</span>            <font class="badlink"><span class="nx">refund</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">REFUND</span></font><span class="p">,</span>
 <span class="mi">47</span>            <font class="badlink"><span class="nx">dormant</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">DORMANT</span></font><span class="p">,</span>
 <span class="mi">48</span>          <span class="p">}),</span>
 <span class="mi">49</span>        <span class="p">}),</span>
 <span class="mi">50</span>        <font class="badlink"><span class="nx">backend</span></font><span class="p">.</span><font class="badlink"><span class="nx">Receiver</span></font><span class="p">(</span><font class="badlink"><span class="nx">ctcReceiver</span></font><span class="p">,</span> <font class="badlink"><span class="nx">common</span></font><span class="p">(</span><span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">rDelay</span></font><span class="p">)),</span>
 <span class="mi">51</span>        <font class="badlink"><span class="nx">backend</span></font><span class="p">.</span><font class="badlink"><span class="nx">Bystander</span></font><span class="p">(</span><font class="badlink"><span class="nx">ctcBystander</span></font><span class="p">,</span> <font class="badlink"><span class="nx">common</span></font><span class="p">(</span><span class="s1">&#39;Bystander&#39;</span><span class="p">)),</span>
 <span class="mi">52</span>      <span class="p">]);</span>
 <span class="mi">53</span>      <font class="badlink"><span class="k">for</span></font> <span class="p">(</span><a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <span class="p">[</span><font class="badlink"><span class="nx">who</span></font><span class="p">,</span> <font class="badlink"><span class="nx">acc</span></font><span class="p">]</span> <font class="badlink"><span class="k">of</span></font> <span class="p">[[</span><span class="s1">&#39;Funder&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">funder</span></font><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">receiver</span></font><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Bystander&#39;</span><span class="p">,</span> <font class="badlink"><span class="nx">bystander</span></font><span class="p">]])</span> <span class="p">{</span>
 <span class="mi">54</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">who</span></font><span class="si">}</span><span class="sb"> has a balance of </span><span class="si">${</span><font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">(</span><font class="badlink"><span class="nx">acc</span></font><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
 <span class="mi">55</span>      <span class="p">}</span>
 <span class="mi">56</span>      <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="err">\</span><span class="sb">n`</span><span class="p">);</span>
 <span class="mi">57</span>    <span class="p">};</span>
 <span class="mi">58</span>    
 <span class="mi">59</span>    <span class="p">(</span><font class="badlink"><span class="nx">async</span></font> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
 <span class="mi">60</span>      <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">runDemo</span></font><span class="p">(</span><a href="ref-programs-compute.html#%28reach._%28%28false%29%29%29" class="kc" data-pltdoc="x">false</a><span class="p">,</span> <a href="ref-programs-compute.html#%28reach._%28%28false%29%29%29" class="kc" data-pltdoc="x">false</a><span class="p">);</span>
 <span class="mi">61</span>      <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">runDemo</span></font><span class="p">(</span><a href="ref-programs-compute.html#%28reach._%28%28true%29%29%29" class="kc" data-pltdoc="x">true</a><span class="p">,</span> <a href="ref-programs-compute.html#%28reach._%28%28false%29%29%29" class="kc" data-pltdoc="x">false</a><span class="p">);</span>
 <span class="mi">62</span>      <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">runDemo</span></font><span class="p">(</span><a href="ref-programs-compute.html#%28reach._%28%28true%29%29%29" class="kc" data-pltdoc="x">true</a><span class="p">,</span> <a href="ref-programs-compute.html#%28reach._%28%28true%29%29%29" class="kc" data-pltdoc="x">true</a><span class="p">);</span>
 <span class="mi">63</span>    <span class="p">})();</span>
</pre></div></div></p><p>The most interesting part of this program is on lines 20 through 23 when we optionally cause a delay in the participant after they receive the signal that the account is funded.</p><p>Let&rsquo;s see what it looks like when we run this program:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ ../reach run</span></p></td></tr><tr><td><p><span class="stt">Begin demo with funder delay(0) and receiver delay(0).</span></p></td></tr><tr><td><p><span class="stt">Receiver sees that the account is funded.</span></p></td></tr><tr><td><p><span class="stt">Bystander sees that the account is funded.</span></p></td></tr><tr><td><p><span class="stt">Funder sees that the account is funded.</span></p></td></tr><tr><td><p><span class="stt">Receiver is ready to receive the funds.</span></p></td></tr><tr><td><p><span class="stt">Receiver received the funds.</span></p></td></tr><tr><td><p><span class="stt">Funder has a balance of 89.99926093</span></p></td></tr><tr><td><p><span class="stt">Receiver has a balance of 109.999956574</span></p></td></tr><tr><td><p><span class="stt">Bystander has a balance of 100.0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Begin demo with funder delay(0) and receiver delay(21).</span></p></td></tr><tr><td><p><span class="stt">Receiver sees that the account is funded.</span></p></td></tr><tr><td><p><span class="stt">Receiver begins to wait...</span></p></td></tr><tr><td><p><span class="stt">Bystander sees that the account is funded.</span></p></td></tr><tr><td><p><span class="stt">Funder sees that the account is funded.</span></p></td></tr><tr><td><p><span class="stt">Funder is ready to receive the funds.</span></p></td></tr><tr><td><p><span class="stt">Receiver is ready to receive the funds.</span></p></td></tr><tr><td><p><span class="stt">Funder received the funds.</span></p></td></tr><tr><td><p><span class="stt">Funder has a balance of 99.999217452</span></p></td></tr><tr><td><p><span class="stt">Receiver has a balance of 99.99995488</span></p></td></tr><tr><td><p><span class="stt">Bystander has a balance of 100.0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">Begin demo with funder delay(31) and receiver delay(21).</span></p></td></tr><tr><td><p><span class="stt">Receiver sees that the account is funded.</span></p></td></tr><tr><td><p><span class="stt">Receiver begins to wait...</span></p></td></tr><tr><td><p><span class="stt">Bystander sees that the account is funded.</span></p></td></tr><tr><td><p><span class="stt">Funder sees that the account is funded.</span></p></td></tr><tr><td><p><span class="stt">Funder begins to wait...</span></p></td></tr><tr><td><p><span class="stt">Receiver is ready to receive the funds.</span></p></td></tr><tr><td><p><span class="stt">Bystander is ready to receive the funds.</span></p></td></tr><tr><td><p><span class="stt">Funder is ready to receive the funds.</span></p></td></tr><tr><td><p><span class="stt">Bystander received the funds.</span></p></td></tr><tr><td><p><span class="stt">Funder has a balance of 89.99921581</span></p></td></tr><tr><td><p><span class="stt">Receiver has a balance of 100.0</span></p></td></tr><tr><td><p><span class="stt">Bystander has a balance of 109.999956956</span></p></td></tr></table></p><h5>4.3.7<tt>&nbsp;</tt><a name="(part._workshop-trust-fund-dns)"></a>Discussion and Next Steps</h5><p>Great job!
You could use this application today and start put your child&rsquo;s college funds away for safe keeping!
Although, perhaps you should wait until you read the workshop about interest-bearing accounts like this.</p><p>If you found this workshop rewarding, please let us know on <a href="https://discord.gg/AZsgcXu">the Discord community</a>!</p><p>If you&rsquo;d like to make this application a little more interesting, maybe you&rsquo;d like to have a secret password just like <a href="workshop-hash-lock.html" data-pltdoc="x">the hash lock</a> as well, so the Funder can separate the revealing of information to Receiver.
Similarly, you could make it like <a href="workshop-relay.html" data-pltdoc="x">a relay account</a> and have the Receiver generated by the Funder and allow the Receiver to specify a third-party (fourth-party) to receive the actual funds.</p><p>We recommend that you take a pause from workshops like this and revisit the <span class="emph">Rock, Paper, Scissors!</span> application in the <a href="workshop-rps-fair.html" data-pltdoc="x">fairness workshop</a>.
Why don&rsquo;t you check it out?</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search docs..." title="Enter a search string to search the Reach documentation" onkeypress="return reach_DoSearch(event, this);"></form>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="workshop-relay.html" title="backward to &quot;4.2 Workshop: Relay Account&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="workshop.html" title="up to &quot;4 Workshop&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="workshop-fomo.html" title="forward to &quot;4.4 Workshop: Fear of Missing Out&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div><script src="reach-post.js"></script></body></html>