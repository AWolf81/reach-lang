<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149147406-1"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-149147406-1');</script><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2.4&nbsp;Bets and Wagers</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="minted-solarizedlight-style.css" title="default"/><link rel="stylesheet" type="text/css" href="minted.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Reach:<span class="mywbr"> &nbsp;</span> The Safest and Easiest DApp Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tut.html" class="tocviewselflink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="guide.html" class="tocviewlink" data-pltdoc="x">Guide</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="workshop.html" class="tocviewlink" data-pltdoc="x">Workshop</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ref.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>2&nbsp;</td><td><a href="tut.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="tut-0.html" class="tocviewlink" data-pltdoc="x">Install and Initialize</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="tut-1.html" class="tocviewlink" data-pltdoc="x">Scaffolding and Setup</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="tut-2.html" class="tocviewlink" data-pltdoc="x">Rock, Paper, and Scissors</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Bets and Wagers</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="tut-4.html" class="tocviewlink" data-pltdoc="x">Trust and Commitments</a></td></tr><tr><td align="right">2.6&nbsp;</td><td><a href="tut-5.html" class="tocviewlink" data-pltdoc="x">Timeouts and Participation</a></td></tr><tr><td align="right">2.7&nbsp;</td><td><a href="tut-6.html" class="tocviewlink" data-pltdoc="x">Play and Play Again</a></td></tr><tr><td align="right">2.8&nbsp;</td><td><a href="tut-7.html" class="tocviewlink" data-pltdoc="x">Interaction and Independence</a></td></tr><tr><td align="right">2.9&nbsp;</td><td><a href="tut-8.html" class="tocviewlink" data-pltdoc="x">Onward and Further</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tut-2.html" title="backward to &quot;2.3 Rock, Paper, and Scissors&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-4.html" title="forward to &quot;2.5 Trust and Commitments&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>2.4<tt>&nbsp;</tt><a name="(part._tut-3)"></a>Bets and Wagers</h4><p>Although it&rsquo;s fun to play <span class="emph">Rock, Paper, Scissors</span> with friends for a laugh, it&rsquo;s even better to play it with enemies and your entire life-savings on the line!
Let&rsquo;s change our program so that Alice can offer a wager to Bob and whoever wins will take the pot.</p><p>This time, let&rsquo;s start with changes to the JavaScript <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> and then we&rsquo;ll go back into the Reach code and connect the new methods up.</p><p>Since we&rsquo;re going to be having funds get transfered, we&rsquo;ll record the balances of each participant before the game starts, so we can more clearly show what they won at the end.
We&rsquo;ll add this code in between account creation and contract deployment.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.mjs#L8-L12"><span class="stt">tut-3/index.mjs</span></a></p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
 <span class="mi">8</span>    <span class="kr">const</span> <span class="nx">accBob</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">stdlib</span><span class="p">.</span><span class="nx">newTestAccount</span><span class="p">(</span><span class="nx">toNetworkFormat</span><span class="p">(</span><span class="s1">&#39;10&#39;</span><span class="p">));</span>
 <span class="mi">9</span>    
<span class="mi">10</span>    <span class="kr">const</span> <span class="nx">getBalance</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">who</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">stdlib</span><span class="p">.</span><span class="nx">fromWei</span><span class="p">(</span> <span class="nx">await</span> <span class="nx">stdlib</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">who</span><span class="p">)</span> <span class="p">);</span>
<span class="mi">11</span>    <span class="kr">const</span> <span class="nx">beforeAlice</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getBalance</span><span class="p">(</span><span class="nx">accAlice</span><span class="p">);</span>
<span class="mi">12</span>    <span class="kr">const</span> <span class="nx">beforeBob</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getBalance</span><span class="p">(</span><span class="nx">accBob</span><span class="p">);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div>
</div></p><ul><li><p>Line 10 shows a helpful function for getting the balance of a participant and displaying it.</p></li><li><p>Line 11 and 12 get the balance before the game starts for both Alice and Bob.</p></li></ul><p>Next, we&rsquo;ll update Alice&rsquo;s interface object to include her wager.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.mjs#L27-L31"><span class="stt">tut-3/index.mjs</span></a></p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">27</span>    <span class="nx">backend</span><span class="p">.</span><span class="nx">Alice</span><span class="p">(</span>
<span class="mi">28</span>      <span class="nx">stdlib</span><span class="p">,</span> <span class="nx">ctcAlice</span><span class="p">,</span>
<span class="mi">29</span>      <span class="p">{</span> <span class="p">...</span><span class="nx">Player</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">),</span>
<span class="mi">30</span>        <span class="nx">wager</span><span class="o">:</span> <span class="nx">toNetworkFormat</span><span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">)</span>
<span class="mi">31</span>      <span class="p">}),</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div>
</div></p><ul><li><p>Line 29 splices the common <code class="highlight-inline"><span class="nx">Player</span></code> interface into Alice&rsquo;s interface.</p></li><li><p>Line 30 defines her wager as <span class="RktInBG"><span class="hspace"></span><span class="RktIn">5</span><span class="hspace"></span></span> units of the <a href="ref-model.html#%28tech._network._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">network token</span></a>.
This is an example of using a concrete value, rather than a function, in a <a href="ref-programs-module.html#%28tech._participant._interact._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant interact interface</span></a>.</p></li></ul><p>For Bob, we&rsquo;ll modify his interface to show the wager and immediately accept it by returning.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.mjs#L32-L36"><span class="stt">tut-3/index.mjs</span></a></p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">32</span>    <span class="nx">backend</span><span class="p">.</span><span class="nx">Bob</span><span class="p">(</span>
<span class="mi">33</span>      <span class="nx">stdlib</span><span class="p">,</span> <span class="nx">ctcBob</span><span class="p">,</span>
<span class="mi">34</span>      <span class="p">{</span> <span class="p">...</span><span class="nx">Player</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">),</span>
<span class="mi">35</span>        <span class="nx">acceptWager</span><span class="o">:</span> <span class="p">(</span><span class="nx">amt</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="mi">36</span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Bob accepts the wager of </span><span class="si">${</span><span class="nx">stdlib</span><span class="p">.</span><span class="nx">fromWei</span><span class="p">(</span><span class="nx">amt</span><span class="p">)</span><span class="si">}</span><span class="sb">.`</span><span class="p">)</span> <span class="p">}</span> <span class="p">)</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div>
</div></p><ul><li><p>Line 35 defines the <code class="highlight-inline"><span class="nx">acceptWager</span></code> function.</p></li></ul><p>Finally, after the computation is over, we&rsquo;ll get the balance again and show a message summarizing the effect.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.mjs#L37-L45"><span class="stt">tut-3/index.mjs</span></a></p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">37</span>    <span class="p">]);</span>
<span class="mi">38</span>    
<span class="mi">39</span>    <span class="kr">const</span> <span class="nx">afterAlice</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getBalance</span><span class="p">(</span><span class="nx">accAlice</span><span class="p">);</span>
<span class="mi">40</span>    <span class="kr">const</span> <span class="nx">afterBob</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getBalance</span><span class="p">(</span><span class="nx">accBob</span><span class="p">);</span>
<span class="mi">41</span>    
<span class="mi">42</span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Alice went from </span><span class="si">${</span><span class="nx">beforeAlice</span><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><span class="nx">afterAlice</span><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
<span class="mi">43</span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Bob went from </span><span class="si">${</span><span class="nx">beforeBob</span><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><span class="nx">afterBob</span><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
<span class="mi">44</span>    
<span class="mi">45</span>    <span class="p">})();</span>
</pre></div>
</div></p><ul><li><p>Lines 39 and 40 get the balances afterwards.</p></li><li><p>Lines 42 and 43 print out the effect.</p></li></ul><p>These changes to the <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> only deal with issues of presentation and interfacing.
The actual business logic of making the wager and transfer the funds will happen in the Reach code.</p><p>Let&rsquo;s look at that now.</p><p>First, we need to update the <a href="ref-programs-module.html#%28tech._participant._interact._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant interact interface</span></a>.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.rsh"><span class="stt">tut-3/index.rsh</span></a></p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span> <span class="mi">1</span>    <span class="s1">&#39;reach 0.1&#39;</span><span class="p">;</span>
 <span class="mi">2</span>    
 <span class="mi">3</span>    <span class="kd">const</span> <span class="nx">Player</span> <span class="o">=</span>
 <span class="mi">4</span>          <span class="p">{</span> <span class="nx">getHand</span><span class="o">:</span> <span class="nb">Fun</span><span class="p">([],</span> <span class="nb">UInt256</span><span class="p">),</span>
 <span class="mi">5</span>            <span class="nx">seeOutcome</span><span class="o">:</span> <span class="nb">Fun</span><span class="p">([</span><span class="nb">UInt256</span><span class="p">],</span> <span class="nb">Null</span><span class="p">)</span> <span class="p">};</span>
 <span class="mi">6</span>    <span class="kd">const</span> <span class="nx">Alice</span> <span class="o">=</span>
 <span class="mi">7</span>          <span class="p">{</span> <span class="p">...</span><span class="nx">Player</span><span class="p">,</span>
 <span class="mi">8</span>            <span class="nx">wager</span><span class="o">:</span> <span class="nb">UInt256</span> <span class="p">};</span>
 <span class="mi">9</span>    <span class="kd">const</span> <span class="nx">Bob</span> <span class="o">=</span>
<span class="mi">10</span>          <span class="p">{</span> <span class="p">...</span><span class="nx">Player</span><span class="p">,</span>
<span class="mi">11</span>            <span class="nx">acceptWager</span><span class="o">:</span> <span class="nb">Fun</span><span class="p">([</span><span class="nb">UInt256</span><span class="p">],</span> <span class="nb">Null</span><span class="p">)</span> <span class="p">};</span>
<span class="mi">12</span>    
<span class="mi">13</span>    <span class="kd">export</span> <span class="kd">const</span> <span class="nx">main</span> <span class="o">=</span>
<span class="mi">14</span>      <span class="nb">Reach</span><span class="p">.</span><span class="nb">App</span><span class="p">(</span>
<span class="mi">15</span>        <span class="p">{},</span>
<span class="mi">16</span>        <span class="p">[[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="nx">Alice</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="nx">Bob</span><span class="p">]],</span>
<span class="mi">17</span>        <span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="p">..</span>          <span class="c1">// ...</span>
<span class="mi">42</span>          <span class="k">exit</span><span class="p">();</span> <span class="p">});</span>
</pre></div>
</div></p><ul><li><p>Lines 6 through 8 define Alice&rsquo;s interface as the <code class="highlight-inline"><span class="nx">Player</span></code> interface, plus an integer value called <code class="highlight-inline"><span class="nx">wager</span></code>.</p></li><li><p>Lines 9 through 11 do the same for Bob, where he has a method called <code class="highlight-inline"><span class="nx">acceptWager</span></code> that can look at the wager value.</p></li><li><p>Line 16 associates these interfaces with the corresponding participants.
The format of this line is a <a href="ref-programs-compute.html#%28tech._tuple%29" class="techoutside" data-pltdoc="x"><span class="techinside">tuple</span></a> of <a href="ref-programs-compute.html#%28tech._tuple%29" class="techoutside" data-pltdoc="x"><span class="techinside">tuples</span></a>, where the first value in the <a href="ref-programs-compute.html#%28tech._tuple%29" class="techoutside" data-pltdoc="x"><span class="techinside">tuple</span></a> is a string that names the <a href="ref-model.html#%28tech._backend%29" class="techoutside" data-pltdoc="x"><span class="techinside">backend</span></a> <a href="ref-model.html#%28tech._participant%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant</span></a> and the second value is the <a href="ref-programs-module.html#%28tech._participant._interact._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant interact interface</span></a>.
It&rsquo;s conventional to name them similarly.</p></li></ul><p>Each of the three parts of the application have to be updated to deal with the wager.
Let&rsquo;s look at Alice&rsquo;s first step first.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.rsh#L18-L23"><span class="stt">tut-3/index.rsh</span></a></p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">18</span>    <span class="nx">A</span><span class="p">.</span><span class="k">only</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mi">19</span>      <span class="kd">const</span> <span class="nx">wager</span> <span class="o">=</span> <span class="k">declassify</span><span class="p">(</span><span class="k">interact</span><span class="p">.</span><span class="nx">wager</span><span class="p">);</span>
<span class="mi">20</span>      <span class="kd">const</span> <span class="nx">handA</span> <span class="o">=</span> <span class="k">declassify</span><span class="p">(</span><span class="k">interact</span><span class="p">.</span><span class="nx">getHand</span><span class="p">());</span> <span class="p">});</span>
<span class="mi">21</span>    <span class="nx">A</span><span class="p">.</span><span class="k">publish</span><span class="p">(</span><span class="nx">wager</span><span class="p">,</span> <span class="nx">handA</span><span class="p">)</span>
<span class="mi">22</span>      <span class="p">.</span><span class="k">pay</span><span class="p">(</span><span class="nx">wager</span><span class="p">);</span>
<span class="mi">23</span>    <span class="k">commit</span><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div>
</div></p><ul><li><p>Line 19 has Alice <a href="ref-programs-local.html#%28tech._declassify%29" class="techoutside" data-pltdoc="x"><span class="techinside">declassify</span></a> the wager for transmission.</p></li><li><p>Line 21 is updated so that Alice shares the wager amount with Bob.</p></li><li><p>Line 22 has her transfer the amount as part of her <a href="ref-model.html#%28tech._publication%29" class="techoutside" data-pltdoc="x"><span class="techinside">publication</span></a>.
The Reach compiler would throw an exception if <code class="highlight-inline"><span class="nx">wager</span></code> did not appear on line 21, but did appear on line 22.
Change the program and try it.
This is because the <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a> needs to be able to verify that the amount of <a href="ref-model.html#%28tech._network._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">network tokens</span></a> included in Alice&rsquo;s <a href="ref-model.html#%28tech._publication%29" class="techoutside" data-pltdoc="x"><span class="techinside">publication</span></a> match some computation available to <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a>.</p></li></ul><p>Next, Bob needs to be shown the wager and given the opportunity to accept it and transfer his funds.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.rsh#L25-L29"><span class="stt">tut-3/index.rsh</span></a></p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">25</span>    <span class="nx">B</span><span class="p">.</span><span class="k">only</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mi">26</span>      <span class="k">interact</span><span class="p">.</span><span class="nx">acceptWager</span><span class="p">(</span><span class="nx">wager</span><span class="p">);</span>
<span class="mi">27</span>      <span class="kd">const</span> <span class="nx">handB</span> <span class="o">=</span> <span class="k">declassify</span><span class="p">(</span><span class="k">interact</span><span class="p">.</span><span class="nx">getHand</span><span class="p">());</span> <span class="p">});</span>
<span class="mi">28</span>    <span class="nx">B</span><span class="p">.</span><span class="k">publish</span><span class="p">(</span><span class="nx">handB</span><span class="p">)</span>
<span class="mi">29</span>      <span class="p">.</span><span class="k">pay</span><span class="p">(</span><span class="nx">wager</span><span class="p">);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div>
</div></p><ul><li><p>Line 26 has Bob accept the wager.
If he doesn&rsquo;t like the terms, his <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> can just not respond to this method and the <a href="ref-model.html#%28tech._dapp%29" class="techoutside" data-pltdoc="x"><span class="techinside">DApp</span></a> will stall.</p></li><li><p>Line 29 has Bob pay the wager as well.</p></li></ul><p>The <a href="ref-model.html#%28tech._dapp%29" class="techoutside" data-pltdoc="x"><span class="techinside">DApp</span></a> is now running in a <a href="ref-model.html#%28tech._consensus._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus step</span></a>.
Before, it would compute the outcome and then commit the state; but now, it needs to look at the outcome and use it to balance the account.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.rsh#L31-L38"><span class="stt">tut-3/index.rsh</span></a></p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">31</span>    <span class="kd">const</span> <span class="nx">outcome</span> <span class="o">=</span> <span class="p">(</span><span class="nx">handA</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="nx">handB</span><span class="p">))</span> <span class="o">%</span> <span class="mi">3</span><span class="p">;</span>
<span class="mi">32</span>    <span class="kd">const</span> <span class="p">[</span><span class="nx">forA</span><span class="p">,</span> <span class="nx">forB</span><span class="p">]</span> <span class="o">=</span>
<span class="mi">33</span>          <span class="nx">outcome</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">?</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">:</span>
<span class="mi">34</span>          <span class="nx">outcome</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">:</span>
<span class="mi">35</span>          <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
<span class="mi">36</span>    <span class="k">transfer</span><span class="p">(</span><span class="nx">forA</span> <span class="o">*</span> <span class="nx">wager</span><span class="p">).</span><span class="nx">to</span><span class="p">(</span><span class="nx">A</span><span class="p">);</span>
<span class="mi">37</span>    <span class="k">transfer</span><span class="p">(</span><span class="nx">forB</span> <span class="o">*</span> <span class="nx">wager</span><span class="p">).</span><span class="nx">to</span><span class="p">(</span><span class="nx">B</span><span class="p">);</span>
<span class="mi">38</span>    <span class="k">commit</span><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div>
</div></p><ul><li><p>Lines 33 through 35 computes the amounts given to each participant depending on the outcome.</p></li><li><p>Lines 36 and 37 transfer the corresponding amounts.</p></li><li><p>Line 38 commits the state of the application and allows the participants to see the outcome and complete.</p></li></ul><p>At this point, we can run the program and see its output by running</p><p><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">./reach run</span></p><p>Since the players act randomly, the results will be different every time.
When I ran the program three times, this is the output I got:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Paper</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.0.</span></p></td></tr><tr><td><p><span class="stt">Bob played Rock</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 10.0 to 14.999999999999687163.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 10.0 to 4.999999999999978229.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Paper</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.0.</span></p></td></tr><tr><td><p><span class="stt">Bob played Scissors</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 10.0 to 4.999999999999687163.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 10.0 to 14.999999999999978246.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Rock</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.0.</span></p></td></tr><tr><td><p><span class="stt">Bob played Scissors</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 10.0 to 14.999999999999687175.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 10.0 to 4.999999999999978229.</span></p></td></tr></table></p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>How come Alice and Bob&rsquo;s balance goes back to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">10.0</span><span class="hspace"></span></span> each time?
It&rsquo;s because every time we run <span class="stt">./reach run</span>, it starts a completely fresh instance of the testing network and creates new accounts for each player.</p></blockquote></blockquote></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>How come the balances aren&rsquo;t exactly <span class="RktInBG"><span class="hspace"></span><span class="RktIn">10</span><span class="hspace"></span></span>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">15</span><span class="hspace"></span></span>, and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">5</span><span class="hspace"></span></span>?
It&rsquo;s because Ethereum transactions cost "gas" to run.</p></blockquote></blockquote></blockquote><p>Alice is doing okay, if she keeps this up, she&rsquo;ll make a fortune on <span class="emph">Rock, Paper, Scissors</span>!</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>If your version isn&rsquo;t working, look at the complete versions of <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.rsh"><span class="stt">tut-3/index.rsh</span></a> and <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-3/index.mjs"><span class="stt">tut-3/index.mjs</span></a> to make sure you copied everything down correctly!</p></blockquote></blockquote></blockquote><p>Now that there is a reason to play this game, it turns out that there&rsquo;s a major security vulnerability.
We&rsquo;ll fix this in <a href="tut-4.html" data-pltdoc="x">the next step</a>; make sure you don&rsquo;t launch with this version, or Alice is going to go broke!</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tut-2.html" title="backward to &quot;2.3 Rock, Paper, and Scissors&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-4.html" title="forward to &quot;2.5 Trust and Commitments&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>