<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149147406-2"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-149147406-2');</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script><script src="tooltips.js"></script><script src="reach-pre.js"></script><link rel="stylesheet" href="tooltips.css"><link rel="stylesheet" href="reach.css"><link rel="stylesheet" href="minted.css"><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2.8&nbsp;Interaction and Independence</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Reach:<span class="mywbr"> &nbsp;</span> The Safest and Easiest DApp Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tut.html" class="tocviewselflink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="guide.html" class="tocviewlink" data-pltdoc="x">Guide</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="workshop.html" class="tocviewlink" data-pltdoc="x">Workshop</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ref.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>2&nbsp;</td><td><a href="tut.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="tut-0.html" class="tocviewlink" data-pltdoc="x">Install and Initialize</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="tut-1.html" class="tocviewlink" data-pltdoc="x">Scaffolding and Setup</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="tut-2.html" class="tocviewlink" data-pltdoc="x">Rock, Paper, and Scissors</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="tut-3.html" class="tocviewlink" data-pltdoc="x">Bets and Wagers</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="tut-4.html" class="tocviewlink" data-pltdoc="x">Trust and Commitments</a></td></tr><tr><td align="right">2.6&nbsp;</td><td><a href="tut-5.html" class="tocviewlink" data-pltdoc="x">Timeouts and Participation</a></td></tr><tr><td align="right">2.7&nbsp;</td><td><a href="tut-6.html" class="tocviewlink" data-pltdoc="x">Play and Play Again</a></td></tr><tr><td align="right">2.8&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Interaction and Independence</a></td></tr><tr><td align="right">2.9&nbsp;</td><td><a href="tut-8.html" class="tocviewlink" data-pltdoc="x">Interaction via web app</a></td></tr><tr><td align="right">2.10&nbsp;</td><td><a href="tut-9.html" class="tocviewlink" data-pltdoc="x">Onward and Further</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tut-6.html" title="backward to &quot;2.7 Play and Play Again&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-8.html" title="forward to &quot;2.9 Interaction via web app&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>2.8<tt>&nbsp;</tt><a name="(part._tut-7)"></a>Interaction and Independence</h4><p>In the last section, we made our <span class="emph">Rock, Paper, Scissors!</span> run until there was a definitive winner.
In this section, we won&rsquo;t be making any changes to the Reach program itself.
Instead, we&rsquo;ll go under the covers of <span class="stt">reach run</span>, as well as build a version of our game that is interactive and can be played away from a private developer test network.</p><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>In the past, when we&rsquo;ve run <span class="stt">./reach run</span>, it would create a Docker image just for our Reach program that contained a temporary Node.js package connecting our JavaScript <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> to the Reach standard library and a fresh instance of a private developer test network.
Since in this section, we will customize this and build a non-automated version of <span class="emph">Rock, Paper, Scissors!</span>, as well as give the option to connect to a real Ethereum network.</p><p>We&rsquo;ll start by running</p><p><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">./reach scaffold</span></p><p>which will automatically generate the following files for us:</p><ul><li><p><span class="stt">package.json</span> &#8212;<wbr></wbr> A Node.js package file that connects our <span class="stt">index.mjs</span> to the Reach standard library.</p></li><li><p><span class="stt">Dockerfile</span> &#8212;<wbr></wbr> A Docker image script that builds our package efficiently and runs it.</p></li><li><p><span class="stt">docker-compose.yml</span> &#8212;<wbr></wbr> A Docker Compose script that connects our Docker image to a fresh instance of the Reach private developer test network.</p></li><li><p><span class="stt">Makefile</span> &#8212;<wbr></wbr> A <span class="stt">Makefile</span> that easily rebuilds and runs the Docker image.</p></li></ul><p>We&rsquo;re going to leave the first two files unchanged.
You can look at them at <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/package.json"><span class="stt">tut-7/package.json</span></a> and <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/Dockerfile"><span class="stt">tut-7/Dockerfile</span></a>, but the details aren&rsquo;t especially important.
However, we&rsquo;ll customize the other two files.</p><p>First, let&rsquo;s look at the <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/docker-compose.yml"><span class="stt">tut-7/docker-compose.yml</span></a> file:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/docker-compose.yml"><span class="stt">tut-7/docker-compose.yml</span></a><button class="btn" data-clipboard-text="version: '3.4'
x-app-base: &amp;app-base
  image: reachsh/reach-app-tut-7:latest
services:
  ethereum-devnet:
    image: reachsh/ethereum-devnet:0.1
  algorand-devnet:
    image: reachsh/algorand-devnet:0.1
    depends_on:
      - algorand-postgres-db
    environment:
      - POSTGRES_HOST=algorand-postgres-db
      - POSTGRES_USER=algogrand
      - POSTGRES_PASSWORD=indexer
      - POSTGRES_DB=pgdb
    ports:
      - 9392
  algorand-postgres-db:
    image: postgres:11
    environment:
      - POSTGRES_USER=algogrand
      - POSTGRES_PASSWORD=indexer
      - POSTGRES_DB=pgdb
  reach-app-tut-7-ETH-live:
    &lt;&lt;: *app-base
    environment:
      - REACH_DEBUG
      - REACH_CONNECTOR_MODE=ETH-live
      - ETH_NODE_URI
      - ETH_NODE_NETWORK
  reach-app-tut-7-ETH-test-dockerized-geth: &amp;default-app
    &lt;&lt;: *app-base
    depends_on:
      - ethereum-devnet
    environment:
      - REACH_DEBUG
      - REACH_CONNECTOR_MODE=ETH-test-dockerized-geth
      - ETH_NODE_URI=http://ethereum-devnet:8545
  reach-app-tut-7-ETH-test-embedded-ganache:
    &lt;&lt;: *app-base
    environment:
      - REACH_DEBUG
      - REACH_CONNECTOR_MODE=ETH-test-embedded-ganache
  reach-app-tut-7-FAKE-test-embedded-mock:
    &lt;&lt;: *app-base
    environment:
      - REACH_DEBUG
      - REACH_CONNECTOR_MODE=FAKE-test-embedded-mock
  reach-app-tut-7-ALGO-test-dockerized-algod-local:
    &lt;&lt;: *app-base
    environment:
      - REACH_DEBUG
      - REACH_CONNECTOR_MODE=ALGO-test-dockerized-algod
      - ALGO_SERVER=http://host.docker.internal
      - ALGO_PORT=4180
      - ALGO_INDEXER_SERVER=http://host.docker.internal
      - ALGO_INDEXER_PORT=8980
  reach-app-tut-7-ALGO-test-dockerized-algod:
    &lt;&lt;: *app-base
    depends_on:
      - algorand-devnet
    environment:
      - REACH_DEBUG
      - REACH_CONNECTOR_MODE=ALGO-test-dockerized-algod
      - ALGO_SERVER=http://algorand-devnet
      - ALGO_PORT=4180
      - ALGO_INDEXER_SERVER=http://algorand-devnet
      - ALGO_INDEXER_PORT=8980
  reach-app-tut-7-: *default-app
  reach-app-tut-7: *default-app
  # After this is new!
  player: &amp;player
    &lt;&lt;: *default-app
    stdin_open: true
  alice: *player
  bob: *player"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span> <span class="nt">1    version</span><span class="p">:</span> <span class="s">&#39;3.4&#39;</span>
 <span class="nt">2    x-app-base</span><span class="p">:</span> <span class="nl">&amp;app-base</span>
 <span class="nt">3      image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reachsh/reach-app-tut-7:latest</span>
 <span class="nt">4    services</span><span class="p">:</span>
 <span class="nt">5      ethereum-devnet</span><span class="p">:</span>
 <span class="nt">6        image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reachsh/ethereum-devnet:0.1</span>
 <span class="nt">7      algorand-devnet</span><span class="p">:</span>
 <span class="nt">8        image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reachsh/algorand-devnet:0.1</span>
 <span class="nt">9        depends_on</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">10          - algorand-postgres-db</span>
<span class="l l-Scalar l-Scalar-Plain">11        environment</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">12          - POSTGRES_HOST=algorand-postgres-db</span>
<span class="l l-Scalar l-Scalar-Plain">13          - POSTGRES_USER=algogrand</span>
<span class="l l-Scalar l-Scalar-Plain">14          - POSTGRES_PASSWORD=indexer</span>
<span class="l l-Scalar l-Scalar-Plain">15          - POSTGRES_DB=pgdb</span>
<span class="nt">16        ports</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">17          - 9392</span>
<span class="nt">18      algorand-postgres-db</span><span class="p">:</span>
<span class="nt">19        image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">postgres:11</span>
<span class="nt">20        environment</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">21          - POSTGRES_USER=algogrand</span>
<span class="l l-Scalar l-Scalar-Plain">22          - POSTGRES_PASSWORD=indexer</span>
<span class="l l-Scalar l-Scalar-Plain">23          - POSTGRES_DB=pgdb</span>
<span class="nt">24      reach-app-tut-7-ETH-live</span><span class="p">:</span>
<span class="nt">25        &lt;&lt;</span><span class="p">:</span> <span class="nv">*app-base</span>
<span class="nt">26        environment</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">27          - REACH_DEBUG</span>
<span class="l l-Scalar l-Scalar-Plain">28          - REACH_CONNECTOR_MODE=ETH-live</span>
<span class="l l-Scalar l-Scalar-Plain">29          - ETH_NODE_URI</span>
<span class="l l-Scalar l-Scalar-Plain">30          - ETH_NODE_NETWORK</span>
<span class="nt">31      reach-app-tut-7-ETH-test-dockerized-geth</span><span class="p">:</span> <span class="nl">&amp;default-app</span>
<span class="nt">32        &lt;&lt;</span><span class="p">:</span> <span class="nv">*app-base</span>
<span class="nt">33        depends_on</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">34          - ethereum-devnet</span>
<span class="nt">35        environment</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">36          - REACH_DEBUG</span>
<span class="l l-Scalar l-Scalar-Plain">37          - REACH_CONNECTOR_MODE=ETH-test-dockerized-geth</span>
<span class="l l-Scalar l-Scalar-Plain">38          - ETH_NODE_URI=http://ethereum-devnet:8545</span>
<span class="nt">39      reach-app-tut-7-ETH-test-embedded-ganache</span><span class="p">:</span>
<span class="nt">40        &lt;&lt;</span><span class="p">:</span> <span class="nv">*app-base</span>
<span class="nt">41        environment</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">42          - REACH_DEBUG</span>
<span class="l l-Scalar l-Scalar-Plain">43          - REACH_CONNECTOR_MODE=ETH-test-embedded-ganache</span>
<span class="nt">44      reach-app-tut-7-FAKE-test-embedded-mock</span><span class="p">:</span>
<span class="nt">45        &lt;&lt;</span><span class="p">:</span> <span class="nv">*app-base</span>
<span class="nt">46        environment</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">47          - REACH_DEBUG</span>
<span class="l l-Scalar l-Scalar-Plain">48          - REACH_CONNECTOR_MODE=FAKE-test-embedded-mock</span>
<span class="nt">49      reach-app-tut-7-ALGO-test-dockerized-algod-local</span><span class="p">:</span>
<span class="nt">50        &lt;&lt;</span><span class="p">:</span> <span class="nv">*app-base</span>
<span class="nt">51        environment</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">52          - REACH_DEBUG</span>
<span class="l l-Scalar l-Scalar-Plain">53          - REACH_CONNECTOR_MODE=ALGO-test-dockerized-algod</span>
<span class="l l-Scalar l-Scalar-Plain">54          - ALGO_SERVER=http://host.docker.internal</span>
<span class="l l-Scalar l-Scalar-Plain">55          - ALGO_PORT=4180</span>
<span class="l l-Scalar l-Scalar-Plain">56          - ALGO_INDEXER_SERVER=http://host.docker.internal</span>
<span class="l l-Scalar l-Scalar-Plain">57          - ALGO_INDEXER_PORT=8980</span>
<span class="nt">58      reach-app-tut-7-ALGO-test-dockerized-algod</span><span class="p">:</span>
<span class="nt">59        &lt;&lt;</span><span class="p">:</span> <span class="nv">*app-base</span>
<span class="nt">60        depends_on</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">61          - algorand-devnet</span>
<span class="nt">62        environment</span><span class="p">:</span>
<span class="l l-Scalar l-Scalar-Plain">63          - REACH_DEBUG</span>
<span class="l l-Scalar l-Scalar-Plain">64          - REACH_CONNECTOR_MODE=ALGO-test-dockerized-algod</span>
<span class="l l-Scalar l-Scalar-Plain">65          - ALGO_SERVER=http://algorand-devnet</span>
<span class="l l-Scalar l-Scalar-Plain">66          - ALGO_PORT=4180</span>
<span class="l l-Scalar l-Scalar-Plain">67          - ALGO_INDEXER_SERVER=http://algorand-devnet</span>
<span class="l l-Scalar l-Scalar-Plain">68          - ALGO_INDEXER_PORT=8980</span>
<span class="nt">69      reach-app-tut-7-</span><span class="p">:</span> <span class="nv">*default-app</span>
<span class="nt">70      reach-app-tut-7</span><span class="p">:</span> <span class="nv">*default-app</span>
<span class="l l-Scalar l-Scalar-Plain">71</span>      <span class="c1"># After this is new!</span>
<span class="nt">72      player</span><span class="p">:</span> <span class="nl">&amp;player</span>
<span class="nt">73        &lt;&lt;</span><span class="p">:</span> <span class="nv">*default-app</span>
<span class="nt">74        stdin_open</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">75      alice</span><span class="p">:</span> <span class="nv">*player</span>
<span class="nt">76      bob</span><span class="p">:</span> <span class="nv">*player</span>
</pre></div></div></p><ul><li><p>Lines 2 and 3 define a service for starting our application.
Your line 3 will say <span class="RktInBG"><span class="hspace"></span><span class="RktIn">tut</span><span class="hspace"></span></span>, rather than <span class="RktInBG"><span class="hspace"></span><span class="RktIn">tut-7</span><span class="hspace"></span></span>, if you&rsquo;ve stayed in the same directory througout the tutorial.</p></li><li><p>Lines 5 and 6 define the Reach private developer test network service for Ethereum.</p></li><li><p>Lines 7 through 23 define the Reach private developer test network service for Algorand.</p></li><li><p>Lines 24 through 72 define services that allow the application to be run with different networks; including line 24, which defines <span class="RktInBG"><span class="hspace"></span><span class="RktIn">reach-app-tut-7-ETH-live</span><span class="hspace"></span></span> for connecting to a live network.</p></li><li><p>We&rsquo;ll also add lines 72 through 76 to define a <span class="RktInBG"><span class="hspace"></span><span class="RktIn">player</span><span class="hspace"></span></span> service that is our application with an open standard input, as well as two instances named <span class="RktInBG"><span class="hspace"></span><span class="RktIn">alice</span><span class="hspace"></span></span> and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">bob</span><span class="hspace"></span></span>.</p></li></ul><p>With these in place, we can run</p><p><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">docker-compose run WHICH</span></p><p>where <span class="stt">WHICH</span> is <span class="RktInBG"><span class="hspace"></span><span class="RktIn">reach-app-tut-7-ETH-live</span><span class="hspace"></span></span> for a live instance, or <span class="RktInBG"><span class="hspace"></span><span class="RktIn">alice</span><span class="hspace"></span></span> or <span class="RktInBG"><span class="hspace"></span><span class="RktIn">bob</span><span class="hspace"></span></span> for a test instance.
If we use the live version, then we have to define the environment variable <span class="stt">ETH_NODE_URI</span> as the URI of our Ethereum node.</p><p>We&rsquo;ll modify the <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/Makefile"><span class="stt">tut-7/Makefile</span></a> to have commands to run each of these variants:</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/Makefile#L29-L39"><span class="stt">tut-7/Makefile</span></a><button class="btn" data-clipboard-text=".PHONY: run-live
run-live:
	docker-compose run --rm reach-app-tut-7-ETH-live

.PHONY: run-alice
run-alice:
	docker-compose run --rm alice

.PHONY: run-bob
run-bob:
	docker-compose run --rm bob"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="err">..</span>    
<span class="nf">29    .PHONY</span><font class="badlink"><span class="o">:</span></font> <span class="n">run</span>-<span class="n">live</span>
<span class="nf">30    run-live</span><font class="badlink"><span class="o">:</span></font>
<span class="err">31</span>    	<span class="err">docker-compose</span> <span class="err">run</span> <span class="err">--rm</span> <span class="err">reach-app-tut-7-ETH-live</span>
<span class="err">32</span>    
<span class="nf">33    .PHONY</span><font class="badlink"><span class="o">:</span></font> <span class="n">run</span>-<span class="n">alice</span>
<span class="nf">34    run-alice</span><font class="badlink"><span class="o">:</span></font>
<span class="err">35</span>    	<span class="err">docker-compose</span> <span class="err">run</span> <span class="err">--rm</span> <span class="err">alice</span>
<span class="err">36</span>    
<span class="nf">37    .PHONY</span><font class="badlink"><span class="o">:</span></font> <span class="n">run</span>-<span class="n">bob</span>
<span class="nf">38    run-bob</span><font class="badlink"><span class="o">:</span></font>
<span class="err">39</span>    	<span class="err">docker-compose</span> <span class="err">run</span> <span class="err">--rm</span> <span class="err">bob</span>
</pre></div></div></p><p>However, if we try to run either of these, it will do the same thing it always has: create test accounts for each user and simulate a random game.
Let&rsquo;s modify the JavaScript <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> and make them interactive.</p><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>We&rsquo;ll start from scratch and show every line of the program again.
You&rsquo;ll see a lot of similarity between this and the last version, but for completeness, we&rsquo;ll show every line.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L1-L6"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="import { loadStdlib } from '@reach-sh/stdlib';
import * as backend from './build/index.main.mjs';
import { ask, yesno, done } from '@reach-sh/stdlib/ask.mjs';

(async () =&gt; {
  const stdlib = await loadStdlib();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span> <span class="mf">1</span>    <font class="badlink"><span class="kr">import</span></font> <span class="p">{</span> <font class="badlink"><span class="nx">loadStdlib</span></font> <span class="p">}</span> <font class="badlink"><span class="nx">from</span></font> <span class="s1">&#39;@reach-sh/stdlib&#39;</span><span class="p">;</span>
 <span class="mf">2</span>    <font class="badlink"><span class="kr">import</span></font> <font class="badlink"><span class="o">*</span></font> <font class="badlink"><span class="nx">as</span></font> <a href="ref-backend-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a> <font class="badlink"><span class="nx">from</span></font> <span class="s1">&#39;./build/index.main.mjs&#39;</span><span class="p">;</span>
 <span class="mf">3</span>    <font class="badlink"><span class="kr">import</span></font> <span class="p">{</span> <a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a><span class="p">,</span> <a href="ref-backend-js.html#%28javascript._%28%28yesno%29%29%29" class="nx" data-pltdoc="x">yesno</a><span class="p">,</span> <a href="ref-backend-js.html#%28javascript._%28%28done%29%29%29" class="nx" data-pltdoc="x">done</a> <span class="p">}</span> <font class="badlink"><span class="nx">from</span></font> <span class="s1">&#39;@reach-sh/stdlib/ask.mjs&#39;</span><span class="p">;</span>
 <span class="mf">4</span>    
 <span class="mf">5</span>    <span class="p">(</span><font class="badlink"><span class="nx">async</span></font> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
 <span class="mf">6</span>    <font class="badlink"><span class="kr">const</span></font> <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">loadStdlib</span></font><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 1 and 2 are the same as before: importing the standard library and the backend.</p></li><li><p>Line 3 is new and imports a helpful library for simple console applications called <span class="stt">ask.mjs</span> from the Reach standard library.
We&rsquo;ll see how these three functions are used below.</p></li></ul><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L7-L12"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="
  const isAlice = await ask(
    `Are you Alice?`,
    yesno
  );
  const who = isAlice ? 'Alice' : 'Bob';"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
 <span class="mf">7</span>    
 <span class="mf">8</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">isAlice</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a><span class="p">(</span>
 <span class="mf">9</span>      <span class="sb">`Are you Alice?`</span><span class="p">,</span>
<span class="mf">10</span>      <a href="ref-backend-js.html#%28javascript._%28%28yesno%29%29%29" class="nx" data-pltdoc="x">yesno</a>
<span class="mf">11</span>    <span class="p">);</span>
<span class="mf">12</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">who</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">isAlice</span></font> <font class="badlink"><span class="o">?</span></font> <span class="s1">&#39;Alice&#39;</span> <font class="badlink"><span class="o">:</span></font> <span class="s1">&#39;Bob&#39;</span><span class="p">;</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 7 through 10 ask the question whether they are playing as Alice and expect a "Yes" or "No" answer.
<code class="highlight"><a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a></code> presents a prompt and collects a line of input until its argument does not error.
<code class="highlight"><a href="ref-backend-js.html#%28javascript._%28%28yesno%29%29%29" class="nx" data-pltdoc="x">yesno</a></code> errors if it is not given "y" or "n".</p></li></ul><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L13-L29"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="
  console.log(`Starting Rock, Paper, Scissors! as ${who}`);

  let acc = null;
  const createAcc = await ask(
    `Would you like to create an account? (only possible on devnet)`,
    yesno
  );
  if (createAcc) {
    acc = await stdlib.newTestAccount(stdlib.parseCurrency(1000));
  } else {
    const secret = await ask(
      `What is your account secret?`,
      (x =&gt; x)
    );
    acc = await stdlib.newAccountFromSecret(secret);
  }"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">13</span>    
<span class="mf">14</span>    <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Starting Rock, Paper, Scissors! as </span><span class="si">${</span><font class="badlink"><span class="nx">who</span></font><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">15</span>    
<span class="mf">16</span>    <font class="badlink"><span class="kd">let</span></font> <font class="badlink"><span class="nx">acc</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="kc">null</span></font><span class="p">;</span>
<span class="mf">17</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">createAcc</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a><span class="p">(</span>
<span class="mf">18</span>      <span class="sb">`Would you like to create an account? (only possible on devnet)`</span><span class="p">,</span>
<span class="mf">19</span>      <a href="ref-backend-js.html#%28javascript._%28%28yesno%29%29%29" class="nx" data-pltdoc="x">yesno</a>
<span class="mf">20</span>    <span class="p">);</span>
<span class="mf">21</span>    <font class="badlink"><span class="k">if</span></font> <span class="p">(</span><font class="badlink"><span class="nx">createAcc</span></font><span class="p">)</span> <span class="p">{</span>
<span class="mf">22</span>      <font class="badlink"><span class="nx">acc</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28new.Test.Account%29%29%29" class="nx" data-pltdoc="x">newTestAccount</a><span class="p">(</span><a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28parse.Currency%29%29%29" class="nx" data-pltdoc="x">parseCurrency</a><span class="p">(</span><span class="mf">1000</span><span class="p">));</span>
<span class="mf">23</span>    <span class="p">}</span> <font class="badlink"><span class="k">else</span></font> <span class="p">{</span>
<span class="mf">24</span>      <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">secret</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a><span class="p">(</span>
<span class="mf">25</span>        <span class="sb">`What is your account secret?`</span><span class="p">,</span>
<span class="mf">26</span>        <span class="p">(</span><font class="badlink"><span class="nx">x</span></font> <span class="p">=&gt;</span> <font class="badlink"><span class="nx">x</span></font><span class="p">)</span>
<span class="mf">27</span>      <span class="p">);</span>
<span class="mf">28</span>      <font class="badlink"><span class="nx">acc</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28new.Account.From.Secret%29%29%29" class="nx" data-pltdoc="x">newAccountFromSecret</a><span class="p">(</span><font class="badlink"><span class="nx">secret</span></font><span class="p">);</span>
<span class="mf">29</span>    <span class="p">}</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 16 through 19 present the user with the choice of creating a test account if they can or inputing a secret to load an existing account.</p></li><li><p>Line 21 creates the test account as before.</p></li><li><p>Line 27 loads the existing account.</p></li></ul><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L30-L46"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="
  let ctc = null;
  const deployCtc = await ask(
    `Do you want to deploy the contract? (y/n)`,
    yesno
  );
  if (deployCtc) {
    ctc = acc.deploy(backend);
    const info = await ctc.getInfo();
    console.log(`The contract is deployed as = ${JSON.stringify(info)}`);
  } else {
    const info = await ask(
      `Please paste the contract information:`,
      JSON.parse
    );
    ctc = acc.attach(backend, info);
  }"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">30</span>    
<span class="mf">31</span>    <font class="badlink"><span class="kd">let</span></font> <font class="badlink"><span class="nx">ctc</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="kc">null</span></font><span class="p">;</span>
<span class="mf">32</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">deployCtc</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a><span class="p">(</span>
<span class="mf">33</span>      <span class="sb">`Do you want to deploy the contract? (y/n)`</span><span class="p">,</span>
<span class="mf">34</span>      <a href="ref-backend-js.html#%28javascript._%28%28yesno%29%29%29" class="nx" data-pltdoc="x">yesno</a>
<span class="mf">35</span>    <span class="p">);</span>
<span class="mf">36</span>    <font class="badlink"><span class="k">if</span></font> <span class="p">(</span><font class="badlink"><span class="nx">deployCtc</span></font><span class="p">)</span> <span class="p">{</span>
<span class="mf">37</span>      <font class="badlink"><span class="nx">ctc</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">acc</span></font><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28deploy%29%29%29" class="nx" data-pltdoc="x">deploy</a><span class="p">(</span><a href="ref-backend-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">);</span>
<span class="mf">38</span>      <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">info</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">ctc</span></font><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28get.Info%29%29%29" class="nx" data-pltdoc="x">getInfo</a><span class="p">();</span>
<span class="mf">39</span>      <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`The contract is deployed as = </span><span class="si">${</span><font class="badlink"><span class="nx">JSON</span></font><span class="p">.</span><font class="badlink"><span class="nx">stringify</span></font><span class="p">(</span><font class="badlink"><span class="nx">info</span></font><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">40</span>    <span class="p">}</span> <font class="badlink"><span class="k">else</span></font> <span class="p">{</span>
<span class="mf">41</span>      <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">info</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a><span class="p">(</span>
<span class="mf">42</span>        <span class="sb">`Please paste the contract information:`</span><span class="p">,</span>
<span class="mf">43</span>        <font class="badlink"><span class="nx">JSON</span></font><span class="p">.</span><font class="badlink"><span class="nx">parse</span></font>
<span class="mf">44</span>      <span class="p">);</span>
<span class="mf">45</span>      <font class="badlink"><span class="nx">ctc</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">acc</span></font><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28attach%29%29%29" class="nx" data-pltdoc="x">attach</a><span class="p">(</span><a href="ref-backend-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">,</span> <font class="badlink"><span class="nx">info</span></font><span class="p">);</span>
<span class="mf">46</span>    <span class="p">}</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 31 through 34 ask if the participant will deploy the contract.</p></li><li><p>Lines 36 through 38 deploy it and print out public information (<code class="highlight"><font class="badlink"><span class="nx">ctc</span></font><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28get.Info%29%29%29" class="nx" data-pltdoc="x">getInfo</a></code>) that can be given to the other player.</p></li><li><p>Lines 40 through 44 request, parse, and process this information.</p></li></ul><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L47-L54"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="
  const fmt = (x) =&gt; stdlib.formatCurrency(x, 4);
  const getBalance = async () =&gt; fmt(await stdlib.balanceOf(acc));

  const before = await getBalance();
  console.log(`Your balance is ${before}`);

  const interact = { ...stdlib.hasRandom };"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">47</span>    
<span class="mf">48</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">fmt</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">x</span></font><span class="p">)</span> <span class="p">=&gt;</span> <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28format.Currency%29%29%29" class="nx" data-pltdoc="x">formatCurrency</a><span class="p">(</span><font class="badlink"><span class="nx">x</span></font><span class="p">,</span> <span class="mf">4</span><span class="p">);</span>
<span class="mf">49</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">getBalance</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">()</span> <span class="p">=&gt;</span> <font class="badlink"><span class="nx">fmt</span></font><span class="p">(</span><font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28balance.Of%29%29%29" class="nx" data-pltdoc="x">balanceOf</a><span class="p">(</span><font class="badlink"><span class="nx">acc</span></font><span class="p">));</span>
<span class="mf">50</span>    
<span class="mf">51</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">before</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">();</span>
<span class="mf">52</span>    <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Your balance is </span><span class="si">${</span><font class="badlink"><span class="nx">before</span></font><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">53</span>    
<span class="mf">54</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">interact</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">{</span> <span class="p">...</span><a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><font class="badlink"><span class="nx">hasRandom</span></font> <span class="p">};</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Next we define a few helper functions and start the participant interaction interface.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L55-L59"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="
  interact.informTimeout = () =&gt; {
    console.log(`There was a timeout.`);
    process.exit(1);
  };"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">55</span>    
<span class="mf">56</span>    <font class="badlink"><span class="nx">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">informTimeout</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">57</span>      <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`There was a timeout.`</span><span class="p">);</span>
<span class="mf">58</span>      <font class="badlink"><span class="nx">process</span></font><span class="p">.</span><font class="badlink"><span class="nx">exit</span></font><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="mf">59</span>    <span class="p">};</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>First we define a timeout handler.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L60-L79"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="
  if (isAlice) {
    const amt = await ask(
      `How much do you want to wager?`,
      stdlib.parseCurrency
    );
    interact.wager = amt;
  } else {
    interact.acceptWager = async (amt) =&gt; {
      const accepted = await ask(
        `Do you accept the wager of ${fmt(amt)}?`,
        yesno
      );
      if (accepted) {
        return;
      } else {
        process.exit(0);
      }
    };
  }"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">60</span>    
<span class="mf">61</span>    <font class="badlink"><span class="k">if</span></font> <span class="p">(</span><font class="badlink"><span class="nx">isAlice</span></font><span class="p">)</span> <span class="p">{</span>
<span class="mf">62</span>      <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">amt</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a><span class="p">(</span>
<span class="mf">63</span>        <span class="sb">`How much do you want to wager?`</span><span class="p">,</span>
<span class="mf">64</span>        <a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-backend-js.html#%28javascript._%28%28parse.Currency%29%29%29" class="nx" data-pltdoc="x">parseCurrency</a>
<span class="mf">65</span>      <span class="p">);</span>
<span class="mf">66</span>      <font class="badlink"><span class="nx">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">wager</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">amt</span></font><span class="p">;</span>
<span class="mf">67</span>    <span class="p">}</span> <font class="badlink"><span class="k">else</span></font> <span class="p">{</span>
<span class="mf">68</span>      <font class="badlink"><span class="nx">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">acceptWager</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">(</span><font class="badlink"><span class="nx">amt</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">69</span>        <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">accepted</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a><span class="p">(</span>
<span class="mf">70</span>          <span class="sb">`Do you accept the wager of </span><span class="si">${</span><font class="badlink"><span class="nx">fmt</span></font><span class="p">(</span><font class="badlink"><span class="nx">amt</span></font><span class="p">)</span><span class="si">}</span><span class="sb">?`</span><span class="p">,</span>
<span class="mf">71</span>          <a href="ref-backend-js.html#%28javascript._%28%28yesno%29%29%29" class="nx" data-pltdoc="x">yesno</a>
<span class="mf">72</span>        <span class="p">);</span>
<span class="mf">73</span>        <font class="badlink"><span class="k">if</span></font> <span class="p">(</span><font class="badlink"><span class="nx">accepted</span></font><span class="p">)</span> <span class="p">{</span>
<span class="mf">74</span>          <font class="badlink"><span class="k">return</span></font><span class="p">;</span>
<span class="mf">75</span>        <span class="p">}</span> <font class="badlink"><span class="k">else</span></font> <span class="p">{</span>
<span class="mf">76</span>          <font class="badlink"><span class="nx">process</span></font><span class="p">.</span><font class="badlink"><span class="nx">exit</span></font><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="mf">77</span>        <span class="p">}</span>
<span class="mf">78</span>      <span class="p">};</span>
<span class="mf">79</span>    <span class="p">}</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Next, we request the wager amount or define the <code class="highlight"><font class="badlink"><span class="nx">acceptWager</span></font></code> method, depending on if we are Alice or not.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L80-L97"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="
  const HAND = ['Rock', 'Paper', 'Scissors'];
  const HANDS = {
    'Rock': 0, 'R': 0, 'r': 0,
    'Paper': 1, 'P': 1, 'p': 1,
    'Scissors': 2, 'S': 2, 's': 2,
  };
  interact.getHand = async () =&gt; {
    const hand = await ask(`What hand will you play?`, (x) =&gt; {
      const hand = HANDS[x];
      if ( hand == null ) {
        throw Error(`Not a valid hand ${hand}`);
      }
      return hand;
    });
    console.log(`You played ${HAND[hand]}`);
    return hand;
  };"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">80</span>    
<span class="mf">81</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">HAND</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">[</span><span class="s1">&#39;Rock&#39;</span><span class="p">,</span> <span class="s1">&#39;Paper&#39;</span><span class="p">,</span> <span class="s1">&#39;Scissors&#39;</span><span class="p">];</span>
<span class="mf">82</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">HANDS</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">{</span>
<span class="mf">83</span>      <span class="s1">&#39;Rock&#39;</span><font class="badlink"><span class="o">:</span></font> <span class="mf">0</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><font class="badlink"><span class="o">:</span></font> <span class="mf">0</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><font class="badlink"><span class="o">:</span></font> <span class="mf">0</span><span class="p">,</span>
<span class="mf">84</span>      <span class="s1">&#39;Paper&#39;</span><font class="badlink"><span class="o">:</span></font> <span class="mf">1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><font class="badlink"><span class="o">:</span></font> <span class="mf">1</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><font class="badlink"><span class="o">:</span></font> <span class="mf">1</span><span class="p">,</span>
<span class="mf">85</span>      <span class="s1">&#39;Scissors&#39;</span><font class="badlink"><span class="o">:</span></font> <span class="mf">2</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><font class="badlink"><span class="o">:</span></font> <span class="mf">2</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><font class="badlink"><span class="o">:</span></font> <span class="mf">2</span><span class="p">,</span>
<span class="mf">86</span>    <span class="p">};</span>
<span class="mf">87</span>    <font class="badlink"><span class="nx">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">getHand</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">88</span>      <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">hand</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <a href="ref-backend-js.html#%28javascript._%28%28ask%29%29%29" class="nx" data-pltdoc="x">ask</a><span class="p">(</span><span class="sb">`What hand will you play?`</span><span class="p">,</span> <span class="p">(</span><font class="badlink"><span class="nx">x</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">89</span>        <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">hand</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">HANDS</span></font><span class="p">[</span><font class="badlink"><span class="nx">x</span></font><span class="p">];</span>
<span class="mf">90</span>        <font class="badlink"><span class="k">if</span></font> <span class="p">(</span> <font class="badlink"><span class="nx">hand</span></font> <font class="badlink"><span class="o">==</span></font> <font class="badlink"><span class="kc">null</span></font> <span class="p">)</span> <span class="p">{</span>
<span class="mf">91</span>          <font class="badlink"><span class="k">throw</span></font> <font class="badlink"><span class="nb">Error</span></font><span class="p">(</span><span class="sb">`Not a valid hand </span><span class="si">${</span><font class="badlink"><span class="nx">hand</span></font><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">92</span>        <span class="p">}</span>
<span class="mf">93</span>        <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="nx">hand</span></font><span class="p">;</span>
<span class="mf">94</span>      <span class="p">});</span>
<span class="mf">95</span>      <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`You played </span><span class="si">${</span><font class="badlink"><span class="nx">HAND</span></font><span class="p">[</span><font class="badlink"><span class="nx">hand</span></font><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">96</span>      <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="nx">hand</span></font><span class="p">;</span>
<span class="mf">97</span>    <span class="p">};</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Next, we define the shared <code class="highlight"><font class="badlink"><span class="nx">getHand</span></font></code> method.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L98-L102"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="
  const OUTCOME = ['Bob wins', 'Draw', 'Alice wins'];
  interact.seeOutcome = async (outcome) =&gt; {
    console.log(`The outcome is: ${OUTCOME[outcome]}`);
  };"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">98</span>    
<span class="mf">99</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">OUTCOME</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">[</span><span class="s1">&#39;Bob wins&#39;</span><span class="p">,</span> <span class="s1">&#39;Draw&#39;</span><span class="p">,</span> <span class="s1">&#39;Alice wins&#39;</span><span class="p">];</span>
<span class="mf">100</span>    <font class="badlink"><span class="nx">interact</span></font><span class="p">.</span><font class="badlink"><span class="nx">seeOutcome</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">async</span></font> <span class="p">(</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">101</span>      <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`The outcome is: </span><span class="si">${</span><font class="badlink"><span class="nx">OUTCOME</span></font><span class="p">[</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">102</span>    <span class="p">};</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Finally, the <code class="highlight"><font class="badlink"><span class="nx">seeOutcome</span></font></code> method.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs#L103-L111"><span class="stt">tut-7/index.mjs</span></a><button class="btn" data-clipboard-text="
  const part = isAlice ? backend.Alice : backend.Bob;
  await part(stdlib, ctc, interact);

  const after = await getBalance();
  console.log(`Your balance is now ${after}`);

  done();
})();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">103</span>    
<span class="mf">104</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">part</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">isAlice</span></font> <font class="badlink"><span class="o">?</span></font> <a href="ref-backend-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">.</span><font class="badlink"><span class="nx">Alice</span></font> <font class="badlink"><span class="o">:</span></font> <a href="ref-backend-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">.</span><font class="badlink"><span class="nx">Bob</span></font><span class="p">;</span>
<span class="mf">105</span>    <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">part</span></font><span class="p">(</span><a href="ref-backend-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">,</span> <font class="badlink"><span class="nx">ctc</span></font><span class="p">,</span> <font class="badlink"><span class="nx">interact</span></font><span class="p">);</span>
<span class="mf">106</span>    
<span class="mf">107</span>    <font class="badlink"><span class="kr">const</span></font> <font class="badlink"><span class="nx">after</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">();</span>
<span class="mf">108</span>    <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Your balance is now </span><span class="si">${</span><font class="badlink"><span class="nx">after</span></font><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">109</span>    
<span class="mf">110</span>    <a href="ref-backend-js.html#%28javascript._%28%28done%29%29%29" class="nx" data-pltdoc="x">done</a><span class="p">();</span>
<span class="mf">111</span>    <span class="p">})();</span>
</pre></div></div></p><p>Lastly, we choose the appropriate backend function and await its completion.</p><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>We can now run</p><p><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">make build</span></p><p>to rebuilt the images, then</p><p><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">make run-alice</span></p><p>in one terminal in this directory and</p><p><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">make run-bob</span></p><p>in another terminal in this directory.</p><p>Here&rsquo;s an example run:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ make run-alice</span></p></td></tr><tr><td><p><span class="stt">Are you Alice?</span></p></td></tr><tr><td><p><span class="stt">y</span></p></td></tr><tr><td><p><span class="stt">Starting Rock, Paper, Scissors as Alice</span></p></td></tr><tr><td><p><span class="stt">Would you like to create an account? (only possible on devnet)</span></p></td></tr><tr><td><p><span class="stt">y</span></p></td></tr><tr><td><p><span class="stt">Do you want to deploy the contract? (y/n)</span></p></td></tr><tr><td><p><span class="stt">y</span></p></td></tr><tr><td><p><span class="stt">The contract is deployed as = {"address":"0xc2a875afbdFb39b1341029A7deceC03750519Db6","creation_block":18,"args":[],"value":{"type":"BigNumber","hex":"0x00"},"creator":"0x2486Cf6C788890885D71667BBCCD1A783131547D"}</span></p></td></tr><tr><td><p><span class="stt">Your balance is 999.9999</span></p></td></tr><tr><td><p><span class="stt">How much do you want to wager?</span></p></td></tr><tr><td><p><span class="stt">10</span></p></td></tr><tr><td><p><span class="stt">What hand will you play?</span></p></td></tr><tr><td><p><span class="stt">r</span></p></td></tr><tr><td><p><span class="stt">You played Rock</span></p></td></tr><tr><td><p><span class="stt">The outcome is: Bob wins</span></p></td></tr><tr><td><p><span class="stt">Your balance is now 989.9999</span></p></td></tr></table></p><p>and</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ make run-bob</span></p></td></tr><tr><td><p><span class="stt">Are you Alice?</span></p></td></tr><tr><td><p><span class="stt">n</span></p></td></tr><tr><td><p><span class="stt">Starting Rock, Paper, Scissors as Bob</span></p></td></tr><tr><td><p><span class="stt">Would you like to create an account? (only possible on devnet)</span></p></td></tr><tr><td><p><span class="stt">y</span></p></td></tr><tr><td><p><span class="stt">Do you want to deploy the contract? (y/n)</span></p></td></tr><tr><td><p><span class="stt">n</span></p></td></tr><tr><td><p><span class="stt">Please paste the contract information:</span></p></td></tr><tr><td><p><span class="stt">{"address":"0xc2a875afbdFb39b1341029A7deceC03750519Db6","creation_block":18,"args":[],"value":{"type":"BigNumber","hex":"0x00"},"creator":"0x2486Cf6C788890885D71667BBCCD1A783131547D"}</span></p></td></tr><tr><td><p><span class="stt">Your balance is 1000</span></p></td></tr><tr><td><p><span class="stt">Do you accept the wager of 10?</span></p></td></tr><tr><td><p><span class="stt">y</span></p></td></tr><tr><td><p><span class="stt">What hand will you play?</span></p></td></tr><tr><td><p><span class="stt">p</span></p></td></tr><tr><td><p><span class="stt">You played Paper</span></p></td></tr><tr><td><p><span class="stt">The outcome is: Bob wins</span></p></td></tr><tr><td><p><span class="stt">Your balance is now 1009.9999</span></p></td></tr></table></p><p>Of course, when you run the exact amounts and addresses may be different.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>If your version isn&rsquo;t working, look at the complete versions of <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.rsh"><span class="stt">tut-7/index.rsh</span></a>, <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.mjs"><span class="stt">tut-7/index.mjs</span></a>, <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/package.json"><span class="stt">tut-7/package.json</span></a>, <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/Dockerfile"><span class="stt">tut-7/Dockerfile</span></a>, <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/docker-compose.yml"><span class="stt">tut-7/docker-compose.yml</span></a>, and <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/Makefile"><span class="stt">tut-7/Makefile</span></a> to make sure you copied everything down correctly!</p></blockquote></blockquote></blockquote><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>If we were to edit <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/docker-compose.yml"><span class="stt">tut-7/docker-compose.yml</span></a>, and move the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">&amp;default-app</span><span class="hspace"></span></span> on line 24 to line 51, then instead of running on Ethereum, we&rsquo;d be able to test and run our application on Algorand.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>We may need to also change line 32 of <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/tut-7/index.rsh"><span class="stt">tut-7/index.rsh</span></a> that defines <code class="highlight"><font class="badlink"><span class="nx">DEADLINE</span></font></code> to be <code class="highlight"><span class="mi">10</span></code> to a higher number, like <code class="highlight"><span class="mi">30</span></code>.
This is because Algorand does not support an input-enabled developer network that only runs rounds when transactions are present, so it is possible that timeouts will occur unexpectedly.
We&rsquo;ve commonly observed this on machines under heavy CPU load.</p></blockquote></blockquote></blockquote><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>Now our implementation of <span class="emph">Rock, Paper, Scissors!</span> is finished!
We are protected against attacks, timeouts, and draws, and we can run interactively on non-test networks.</p><p>In this step, we made a command line interface for our Reach program.
In <a href="tut-8.html" data-pltdoc="x">the next step</a>, we&rsquo;ll replace this with a web interface for the same Reach program.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="tut-6.html" title="backward to &quot;2.7 Play and Play Again&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-8.html" title="forward to &quot;2.9 Interaction via web app&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div><script src="reach-post.js"></script></body></html>